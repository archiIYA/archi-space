<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz â€” Architecture mÃ©sopotamienne</title>

  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    /* === Ø§Ø­ØªÙØ¸Øª Ø¨ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ØµÙ„ ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª === */
    body {
      margin: 0;
      font-family: 'Rubik', sans-serif;
      background: #fff;
      color: #111;
      display: flex;
      min-height: 100vh;
      flex-wrap: wrap; /* Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ¬Ø§ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„ØµØºÙŠØ±Ø© */
    }

    aside {
      width: 240px;
      background-color: #f4f4f4;
      height: 100vh;
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      overflow-y: auto;
      position: fixed;
      left: 0;
      top: 0;
      transform: translateX(0);
      transition: transform 0.3s ease;
      z-index: 998;
    }

    aside.hidden {
      transform: translateX(-260px);
    }

    .back-button {
      margin-bottom: 20px;
      background-color: #ddd;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
      font-weight: 600;
    }

    #toggleSidebar {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 999;
      background-color: #111;
      color: #fff;
      border: none;
      padding: 10px 15px;
      font-size: 18px;
      border-radius: 6px;
      cursor: pointer;
      transition: left 0.3s ease;
    }

    main {
      flex-grow: 1;
      padding: 30px;
      margin-left: 240px;
      transition: margin-left 0.3s ease;
    }

    main.expanded {
      margin-left: 0;
    }
    
    .section-title {
      font-size: 26px;
      margin-bottom: 20px;
      color: #000;
    }

    .lesson { margin-bottom: 30px; padding: 20px; border-radius: 10px; background: linear-gradient(180deg, #fbfbfb 0%, #ffffff 100%); box-shadow: 0 6px 18px rgba(8,24,40,0.06); border:1px solid rgba(15,23,42,0.04); }

    .buttons { margin-top: 10px; display:flex; gap:10px; align-items:center; }

    .buttons a, .buttons button {
      background: none;
      border: 1px solid #e6e6e6;
      padding:8px 12px;
      border-radius:8px;
      font-size: 16px;
      cursor: pointer;
      background-color:#fff;
      text-decoration: none; /* Ù„Ù…Ù†Ø¹ Ø®Ø· Ø§Ù„ØªØ³Ø·ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· */
      color: #111; /* Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù„ÙˆÙ† Ø§Ù„Ù†Øµ */
    }
    
    .buttons a {
      display: inline-block; /* Ù„ÙƒÙŠ ÙŠØ£Ø®Ø° Ø§Ù„Ù€`<a>` Ù†ÙØ³ Ø­Ø¬Ù… Ø§Ù„Ø²Ø± */
    }

    /* Modal quiz (copy of your original style) */
    .quiz-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      background: linear-gradient(0deg, rgba(2,6,23,0.55), rgba(2,6,23,0.55));
      padding: 24px;
    }
    .quiz-card {
      width: 100%;
      max-width: 960px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 20px 50px rgba(2,6,23,0.4);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      animation: pop .18s ease;
    }
    @keyframes pop { from { transform: translateY(12px) scale(.99); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
    .quiz-header { padding: 18px 22px; background: linear-gradient(90deg,#0ea5a4,#0ea5a4 60%, #06b6d4 100%); color: #fff; display:flex; align-items:center; justify-content:space-between; }
    .quiz-header h2 { margin:0; font-size:18px; }
    .quiz-body { padding: 22px; display: grid; grid-template-columns: 1fr 320px; gap: 20px; }
    .question-area { background:#fbfdff; padding:18px; border-radius:10px; min-height:320px; }
    .question-index { font-size:13px; color:#666; margin-bottom:8px; }
    .question-text { font-size:18px; color:#0f172a; margin-bottom:12px; }
    .options { display:flex; flex-direction:column; gap:10px; }
    .option { background:#fff; border:1px solid #e6eef2; padding:12px 14px; border-radius:8px; cursor:pointer; display:flex; align-items:center; gap:10px; }
    .option input { transform:scale(1.15); }
    .sidebar-panel { background:#ffffff; border-radius:10px; padding:14px; border:1px solid #eef6f9; height:100%; }
    .timer { font-weight:700; font-size:20px; color:#0f172a; }
    .meta { margin-top:12px; color:#475569; font-size:14px; }
    .nav-buttons { display:flex; gap:10px; margin-top:18px; }
    .btn { padding:10px 14px; border-radius:8px; background:#0ea5a4; color:#fff; border:none; cursor:pointer; font-weight:600; }
    .btn.secondary { background:#e6eef2; color:#0f172a; }
    .close-quiz { background:transparent; border:0; color:rgba(255,255,255,0.9); font-weight:700; cursor:pointer; }
    .result { padding:20px; }
    .answers-list { margin-top:12px; display:flex; flex-direction:column; gap:10px; max-height:320px; overflow:auto; }
    .answer-item { background:#fcfcff; border:1px solid #eef2ff; padding:12px; border-radius:8px; }

    @media (max-width: 880px) {
      .quiz-body { grid-template-columns: 1fr; }
      .sidebar-panel { order: -1; }
      .quiz-card { max-width: 96%; }
    }
    
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      aside {
        height: auto;
        position: relative;
        width: 100%;
        transform: translateX(0);
        box-shadow: none;
        transition: none;
      }
      main {
        margin-left: 0;
      }
      aside.hidden {
        display: none;
      }
      #toggleSidebar {
        position: relative;
        top: auto;
        left: auto;
        margin-bottom: 20px;
      }
    }
  </style>
</head>
<body>

<button id="toggleSidebar">â˜° Menu</button>

<aside class="sidebar">
  <a href="sem1.html" class="back-button">ğŸ”™ Retour Ã  Semestre 1</a>
  <button class="back-button" onclick="history.back()">ğŸ”™ Retour</button>

  <div class="sidebar-header">
    <h2>ğŸ“š AnnÃ©e 1 - Semestre 1</h2>
  </div>

  <ul class="sidebar-menu">
    <li><a href="atelier1.html">ğŸ—ï¸ Atelier de projet 1</a></li>
    <li><a href="dca1.html">ğŸ“ DCA 1</a></li>
    <li><a href="dag1.html">ğŸ¨ DAG 1</a></li>
    <li><a href="histoire1.html">ğŸ›ï¸ Histoire de lâ€™Architecture 1</a></li>
    <li><a href="theorie1.html">ğŸ“˜ ThÃ©orie de projet 1</a></li>
    <li><a href="geometrie1.html">ğŸ“ GÃ©omÃ©trie de lâ€™espace 1</a></li>
    <li><a href="tmc1.html">ğŸ§± TMC 1</a></li>
    <li><a href="math1.html">ğŸ§® MathÃ©matiques</a></li>
    <li><a href="expression1.html">ğŸ—£ï¸ Expression orale</a></li>
    <li><a href="stage.html">ğŸï¸ Stage dÃ©couverte 1</a></li>
    <hr>
    <li><a href="projets.html">ğŸ’¼ Projets</a></li>
    <li><a href="mailto:archispaceiya@gmail.com">ğŸ“© Contact</a></li>
  </ul>
</aside>

<main>
  <h1 class="section-title">ğŸ›ï¸ Architecture mÃ©sopotamienne â€” Quiz</h1>

  <div class="lesson">
    <h3>
      <span>Architecture mÃ©sopotamienne</span>
      <span>
        <button id="openQuizBtn" title="Ouvrir le quiz" style="background:#06b6d4;color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;">ğŸ“ Quiz â€” 100 Q</button>
      </span>
    </h3>
    <div class="buttons">
      <a href="LA CIVILISATION MESOPOTAMIENNEzd.pdf">ğŸ“„ PDF</a>
      <button>ğŸ¥ VidÃ©o</button>
      <button>â­ Premium</button>
    </div>
    <p style="margin-top:12px; color:#475569;">100 Ø³Ø¤Ø§Ù„ â€” Ù…Ø³ØªÙˆÙ‰: ØµØ¹Ø¨ â†’ ØµØ¹Ø¨ Ø¬Ø¯Ù‹Ø§ â€” ØªÙˆÙ‚ÙŠØª: 30 Ø¯Ù‚ÙŠÙ‚Ø©.</p>
  </div>

  <footer>
    Â© 2025 ArchiSpace â€“ Tous droits rÃ©servÃ©s.
  </footer>
</main>

<div id="quizModal" class="quiz-modal" aria-hidden="true">
  <div class="quiz-card" role="dialog" aria-modal="true">
    <div class="quiz-header">
      <h2>Quiz â€” Architecture mÃ©sopotamienne</h2>
      <div class="quiz-controls">
        <div style="font-size:13px;opacity:0.95;">Choisissez le type :</div>
        <select id="quizTypeSelect" style="padding:6px 10px; border-radius:8px; border:none; font-weight:600;">
          <option value="QCM">QCM (choix multiples)</option>
          <option value="QCS">QCS (choix unique)</option>
          <option value="VF">Vrai / Faux</option>
        </select>
        <button class="close-quiz" id="closeQuizBtn">âœ•</button>
      </div>
    </div>

    <div class="quiz-body">
      <div class="question-area">
        <div class="question-index" id="questionIndex">Question 1 / 100</div>
        <div class="question-text" id="questionText">Choisissez un type puis dÃ©marrez.</div>

        <div class="options" id="optionsContainer"></div>

        <div class="nav-buttons">
          <button class="btn secondary" id="prevBtn" disabled>â—€ PrÃ©cÃ©dent</button>
          <button class="btn secondary" id="nextBtn" disabled>Suivant â–¶</button>
          <button class="btn" id="submitBtn" style="display:none;">Soumettre</button>
        </div>
      </div>

      <div class="sidebar-panel">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-size:13px;color:#64748b;">Timer</div>
            <div class="timer" id="timerDisplay">30:00</div>
          </div>
          <div style="text-align:right;">
            <div style="font-size:13px;color:#64748b;">Score</div>
            <div style="font-weight:700; font-size:18px;" id="scoreDisplay">0</div>
          </div>
        </div>

        <div class="meta">
          <div>Type: <span id="selectedType">â€”</span></div>
          <div style="margin-top:8px;">Questions totales: <b id="totalQuestions">100</b></div>
          <div style="margin-top:6px;">Questions restantes: <b id="remainingQuestions">100</b></div>
          <div style="margin-top:8px;">RÃ©essayer les mauvaises rÃ©ponses: <input type="checkbox" id="retryWrong" checked></div>
        </div>

        <div style="margin-top:14px;">
          <button class="btn" id="startBtn">Commencer</button>
          <button class="btn secondary" id="endEarlyBtn" style="margin-left:8px;">Finir maintenant</button>
        </div>

        <div style="margin-top:12px; font-size:13px; color:#475569;">
          <div>Navigation: utilisez â—€ / â–¶ ou les boutons.</div>
          <div style="margin-top:8px;">AprÃ¨s soumission, les erreurs seront regroupÃ©es et proposÃ©es Ã  nouveau.</div>
        </div>
      </div>
    </div>

    <div id="resultArea" style="display:none;" class="result">
      <h3>RÃ©sultat</h3>
      <div id="resultSummary"></div>
      <div class="answers-list" id="answersList"></div>
      <div style="margin-top:14px;">
        <button class="btn" id="retryBtn">Reprendre les questions incorrectes</button>
        <button class="btn secondary" id="closeResultBtn" style="margin-left:10px;">Fermer</button>
      </div>
    </div>

  </div>
</div>

<script>
    /* Sidebar toggle */
    const sidebar = document.querySelector('aside');
    const mainContent = document.querySelector('main');
    const toggleBtn = document.getElementById('toggleSidebar');

    toggleBtn.addEventListener('click', () => {
        sidebar.classList.toggle('hidden');
        mainContent.classList.toggle('expanded');
    });

    /* Quiz logic elements */
    const openQuizBtn = document.getElementById('openQuizBtn');
    const quizModal = document.getElementById('quizModal');
    const closeQuizBtn = document.getElementById('closeQuizBtn');
    const startBtn = document.getElementById('startBtn');
    const endEarlyBtn = document.getElementById('endEarlyBtn');
    const submitBtn = document.getElementById('submitBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const questionText = document.getElementById('questionText');
    const optionsContainer = document.getElementById('optionsContainer');
    const questionIndex = document.getElementById('questionIndex');
    const timerDisplay = document.getElementById('timerDisplay');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const selectedTypeLabel = document.getElementById('selectedType');
    const totalQuestionsLabel = document.getElementById('totalQuestions');
    const remainingQuestionsLabel = document.getElementById('remainingQuestions');
    const retryWrongInput = document.getElementById('retryWrong');
    const resultArea = document.getElementById('resultArea');
    const resultSummary = document.getElementById('resultSummary');
    const answersList = document.getElementById('answersList');
    const retryBtn = document.getElementById('retryBtn');
    const closeResultBtn = document.getElementById('closeResultBtn');
    const quizTypeSelect = document.getElementById('quizTypeSelect');

    let allQuestions = [];
    let currentSet = [];
    let currentIndex = 0;
    let answers = [];
    let score = 0;
    let timer = null;
    let timeLeft = 30 * 60; // 30 minutes
    let wrongQuestions = [];
    let retryMode = false;

    /* ===========================
        QUESTIONS DATA â€” 100 Ø£Ø³Ø¦Ù„Ø©
        â€” Ø§Ù„ØªÙˆØ²ÙŠØ¹: 40 QCM (choix multiples), 30 QCS (choix unique), 30 VF (Vrai/Faux)
        â€” Ù…Ø³ØªÙˆÙ‰: ØµØ¹Ø¨ â†’ ØµØ¹Ø¨ Ø¬Ø¯Ù‹Ø§
    =========================== */
    allQuestions = [
        /* ----- QCM 1..40 (choix multiples) ----- */
        { id:'q1', type:'QCM', question:"Quels rÃ´les remplissait une ziggurat dans la citÃ© mÃ©sopotamienne ?", options:["Sanctuaire religieux","Plate-forme cÃ©rÃ©monielle","RÃ©sidence du roi","Usine de poterie"], answer:[0,1]},
        { id:'q2', type:'QCM', question:"Quels matÃ©riaux dominent la construction en MÃ©sopotamie antique ?", options:["Brique crue (pisÃ©)","Pierre de taille abondante","Brique cuite","Bois importÃ©"], answer:[0,2]},
        { id:'q3', type:'QCM', question:"Parmi ces fonctions, lesquelles pouvaient Ãªtre attribuÃ©es au temple-mÃ©nos (temple Ã©conomique) ?", options:["Stockage des rÃ©coltes","Centre administratif","Bureau de prÃªt de grains","Manufacture d'armes"], answer:[0,1,2]},
        { id:'q4', type:'QCM', question:"Quelles caractÃ©ristiques dÃ©finissent l'urbanisme sumÃ©rien classique ?", options:["AgglomÃ©ration autour du temple","Rues sinueuses","PrÃ©sence d'une enceinte fortifiÃ©e","Grands axes orthogonaux"], answer:[0,1,2]},
        { id:'q5', type:'QCM', question:"Quelles techniques constructives assyriennes sont reconnues ?", options:["Usage intensif de la brique cuite","RevÃªtements d'argile dÃ©coratifs","Corbelement pour voÃ»tes","BÃ©ton romain"], answer:[0,1,2]},
        { id:'q6', type:'QCM', question:"Quels Ã©lÃ©ments dÃ©coratifs trouve-t-on frÃ©quemment sur les faÃ§ades mÃ©sopotamiennes ?", options:["Plaques d'Ã©mail (glazed bricks)","Bas-reliefs narratifs","MosaÃ¯ques de marbre","Panneaux en bronze estampÃ©"], answer:[0,1]},
        { id:'q7', type:'QCM', question:"Quels sont des exemples de citÃ©s-Ã‰tats mÃ©sopotamiennes ?", options:["Uruk","Ur","Babylone","AthÃ¨nes"], answer:[0,1,2]},
        { id:'q8', type:'QCM', question:"Quelles innovations rurales ont influencÃ© l'architecture mÃ©sopotamienne ?", options:["SystÃ¨mes d'irrigation","Barrage et digues","Serres en verre","Canaux de drainage"], answer:[0,1,3]},
        { id:'q9', type:'QCM', question:"Quelles fonctions remplissaient les murs d'enceinte dans les citÃ©s mÃ©sopotamiennes ?", options:["DÃ©fense militaire","RÃ©gulation du commerce","DÃ©limitation religieuse","ContrÃ´le des impÃ´ts"], answer:[0,1,3]},
        { id:'q10', type:'QCM', question:"Quels sont les usages des cours intÃ©rieures dans les maisons urbaines mÃ©sopotamiennes ?", options:["Ventilation et lumiÃ¨re","Espace de stockage","Atelier artisanal","Ã‰table pour animaux"], answer:[0,1,2]},
        { id:'q11', type:'QCM', question:"Quels attributs associe-t-on aux palais royaux assyriens ?", options:["Salles d'apparat colossales","Bas-reliefs cÃ©lÃ©brant les conquÃªtes","Plans axiaux trÃ¨s rigides","Toits en pointe gothique"], answer:[0,1,2]},
        { id:'q12', type:'QCM', question:"Quelles preuves archÃ©ologiques indiquent une administration centralisÃ©e ?", options:["Tablettes d'argile comptables","Inventaires de stockage","Plans de voirie","Monuments funÃ©raires privÃ©s"], answer:[0,1]},
        { id:'q13', type:'QCM', question:"Quels usages des cylindres-sceaux (cylinder seals) ont un impact sur l'architecture ?", options:["Authentification des documents de stockage","Marquage des portes et biens","DÃ©coration murale","Planification urbaine"], answer:[0,1]},
        { id:'q14', type:'QCM', question:"Quelles motivations religieuses Ã©taient liÃ©es Ã  l'Ã©lÃ©vation d'une ziggurat ?", options:["Lieu d'intermÃ©diation entre ciel et terre","Sanctuaire pour la statue du dieu","AccÃ¨s routinier pour tous les habitants","Performances rituelles Ã©litistes"], answer:[0,1,3]},
        { id:'q15', type:'QCM', question:"Quels Ã©lÃ©ments rendent fragiles les constructions mÃ©sopotamiennes pour la conservation archÃ©ologique ?", options:["MatÃ©riaux organiques (bois)","Erosion due Ã  inondations","Utilisation majoritaire de terre crue","SismicitÃ©"], answer:[1,2]},
        { id:'q16', type:'QCM', question:"Quelles mÃ©thodes utilisaient-ils pour Ã©lever de grandes masses (comme les ziggurats) ?", options:["Ramps (ramps) et talus","Structures en coffrage de bois","Grues mÃ©caniques modernes","Empilement de mastabas"], answer:[0,1]},
        { id:'q17', type:'QCM', question:"Quelles caractÃ©ristiques distinguent l'architecture babylonienne tardive ?", options:["DÃ©cor Ã©maillÃ© polychrome","Portes monumentales Ã  dÃ©cor animalier","Plan de citÃ© romain","Usage du marbre importÃ©"], answer:[0,1]},
        { id:'q18', type:'QCM', question:"Quels types de voÃ»tes sont attestÃ©s en MÃ©sopotamie ?", options:["Corbelement (voÃ»tes en encorbellement)","VoÃ»te en plein cintre standard romain","DÃ´mes en brique","VoÃ»tes nervurÃ©es gothiques"], answer:[0,2]},
        { id:'q19', type:'QCM', question:"Quels facteurs dÃ©terminent l'implantation d'une citÃ© mÃ©sopotamienne ?", options:["AccÃ¨s Ã  l'eau douce","Vias commerciales fluviales","ProximitÃ© de carriÃ¨res de pierre","Ressources minÃ©rales rares"], answer:[0,1,2]},
        { id:'q20', type:'QCM', question:"Quelles fonctions la Â«cour du templeÂ» pouvait-elle inclure ?", options:["Espace de redistribution des biens","Lieu de rÃ©unions judiciaires","Zone d'artisanat liÃ© au culte","Habitat privÃ© royal"], answer:[0,1,2]},
        { id:'q21', type:'QCM', question:"Quelles sont les implications de l'usage de la brique cuite pour les Ã©lÃ©vations ?", options:["Meilleure durabilitÃ©","PossibilitÃ© d'ornement Ã©maillÃ©","Augmentation du coÃ»t","RÃ©duction de la flexibilitÃ© constructive"], answer:[0,1,2]},
        { id:'q22', type:'QCM', question:"Quelles caractÃ©ristiques dÃ©fissent l'art monumental assyrien ?", options:["Panel narratif montrant campagnes militaires","Sculpture en ronde-bosse massive","PrÃ©fÃ©rence pour motifs vÃ©gÃ©taux abstraits","Inscriptions royales abondantes"], answer:[0,3]},
        { id:'q23', type:'QCM', question:"Quels systÃ¨mes hydrauliques ont Ã©tÃ© dÃ©veloppÃ©s ?", options:["Canaux d'irrigation complexes","Bassins de rÃ©tention","Ã‰cluses de style europÃ©en","SystÃ¨mes de drainage urbains"], answer:[0,1,3]},
        { id:'q24', type:'QCM', question:"Quels types de planimÃ©tries domestiques sont observÃ©s ?", options:["Maisons agglutinÃ©es sans rue devant","Maisons avec cour centrale","Maisons Ã  accÃ¨s par ruelle","Immeubles Ã  Ã©tages mÃ©diÃ©vaux"], answer:[0,1,2]},
        { id:'q25', type:'QCM', question:"Quelles fonctions Ã©conomiques Ã©taient liÃ©es aux temples ?", options:["RÃ©colte et stockage des taxes","Redistribution alimentaire","Production artisanale sous contrÃ´le religieux","Centre bancaire de prÃªts"], answer:[0,1,2,3]},
        { id:'q26', type:'QCM', question:"Quels Ã©lÃ©ments apparaissent sur les portes monumentales babyloniennes ?", options:["Motifs d'animaux mythiques (taureaux, dragons)","Inscriptions royales","FenÃªtres panoramiques","Polychromie en brique Ã©maillÃ©e"], answer:[0,1,3]},
        { id:'q27', type:'QCM', question:"Quelles diffÃ©rences architecturales observe-t-on entre Uruk et Nineveh ?", options:["Uruk: premiÃ¨res murailles massives / Nineveh: palais assyriens monumentaux","Uruk: usage intensif du marbre / Nineveh: bois dominant","Uruk: plan urbain romain / Nineveh: plan organique"], answer:[0]},
        { id:'q28', type:'QCM', question:"Quelles fonctions assurait la rue principale en citÃ© mÃ©sopotamienne ?", options:["Flux commercial","Rituels publics","AccÃ¨s aux entrepÃ´ts du temple","RÃ©seau sanitaire moderne"], answer:[0,1,2]},
        { id:'q29', type:'QCM', question:"Quels procÃ©dÃ©s permettaient la dÃ©coration pÃ©renne des faÃ§ades ?", options:["Briques Ã©maillÃ©es polychromes","Plaques d'argile sculptÃ©e","Tapisseries murales","RevÃªtements mÃ©talliques"], answer:[0,1]},
        { id:'q30', type:'QCM', question:"Quelles innovations techniques facilitÃ¨rent la construction de voÃ»tes/dÃ´mes en brique ?", options:["Connaissance du mortier argileux","SÃ©lection de briques cuites rÃ©guliÃ¨res","Usage de coffrages de bois temporaires","Introduction du ciment romain"], answer:[0,1,2]},
        { id:'q31', type:'QCM', question:"Quels usages des citÃ©s-Ã‰tats ont un impact sur l'architecture religieuse ?", options:["RivalitÃ© entre citÃ©s favorisant monuments sacrÃ©s","Centralisation du pouvoir royal","Influence de cultes Ã©trangers sur styles","RÃ©duction des dÃ©penses publiques"], answer:[0,1,2]},
        { id:'q32', type:'QCM', question:"Quelles sources archÃ©ologiques sont essentielles pour reconstituer l'architecture mÃ©sopotamienne ?", options:["Plans et fondations fouillÃ©es","Tablettes cunÃ©iformes dÃ©crivant bÃ¢timents","Reconstitutions artistiques anciennes","Reliefs sculptÃ©s montrant Ã©lÃ©vations"], answer:[0,1,3]},
        { id:'q33', type:'QCM', question:"Quels rÃ´les jouait l'articulation axiale (axe central) dans les temples mÃ©sopotamiens ?", options:["Rangement des processions","HiÃ©rarchisation des espaces","Alignement astronomique prÃ©cis","Confort thermique"], answer:[0,1]},
        { id:'q34', type:'QCM', question:"Quels sont des exemples d'occupation continue crÃ©ant des 'tells' ?", options:["Accumulation de niveaux d'habitat successifs","RÃ©utilisation des briques anciennes comme remblai","DÃ©pÃ´ts d'objets sacrificiels","Construction de pyramides"] , answer:[0,1]},
        { id:'q35', type:'QCM', question:"Qu'est-ce qui explique l'importance des entrepÃ´ts dans le plan urbain ?", options:["Ã‰conomie de surplus agricole","Administration centralisÃ©e des taxes","NÃ©cessitÃ© de stocker affaires militaires","Usage comme lieux de culte"], answer:[0,1]},
        { id:'q36', type:'QCM', question:"Quels sont les liens entre iconographie sculptÃ©e et propagande royale ?", options:["Bas-reliefs montrant roi dominants ennemis","Inscriptions glorifiant conquÃªtes","Emploi de scÃ¨nes quotidiennes uniquement","Usage de motifs divins pour lÃ©gitimer pouvoir"], answer:[0,1,3]},
        { id:'q37', type:'QCM', question:"Quelles techniques permettaient l'Ã©tanchÃ©itÃ© des bassins et canaux ?", options:["RevÃªtement argileux compactÃ©","Utilisation de mortier bitumineux","Carrelage de pierre jointif","Tapis d'Ã©tanchÃ©itÃ© moderne"], answer:[0,1,2]},
        { id:'q38', type:'QCM', question:"Quelles rÃ©ponses architecturales aux inondations observait-on ?", options:["SurÃ©lever niveaux d'occupation (terrasses)","Construire digues et canaux","Imposer zones inondables agricoles","CrÃ©er systÃ¨mes d'Ã©vacuation souterrains"], answer:[0,1,2]},
        { id:'q39', type:'QCM', question:"Quels Ã©lÃ©ments reflÃ¨tent l'autoritÃ© religieuse dans les bÃ¢timents ?", options:["AccÃ¨s restreint aux sanctuaires","Statues cultuelles centralisÃ©es","Archives et trÃ©sors stockÃ©s dans le temple","Grandes fenÃªtres publiques"], answer:[0,1,2]},
        { id:'q40', type:'QCM', question:"Quelles transformations techniques sont apportÃ©es par l'usage massif de la brique cuite ?", options:["PossibilitÃ© d'Ã©lÃ©vations plus hautes","DÃ©cor polychrome permanent","Standardisation modulaire","AmÃ©lioration de la rÃ©sistance au feu"], answer:[0,1,2]},
        
        /* ----- QCS 41..70 (choix simple) ----- */
        { id:'q41', type:'QCS', question:"Quelle ville est cÃ©lÃ¨bre pour son ziggurat dÃ©diÃ©e au dieu Nanna (Lune) ?", options:["Babylone","Ur","Nineveh","Assur"], answer:[1]},
        { id:'q42', type:'QCS', question:"La principale matiÃ¨re de construction en MÃ©sopotamie Ã©tait :", options:["Marbre taillÃ©","Brique crue et cuite","Pierre calcaire","Bois massif"], answer:[1]},
        { id:'q43', type:'QCS', question:"Quel roi est associÃ© Ã  la reconstruction et aux murailles polychromes de Babylone (porte d'Ishtar) ?", options:["Sargon d'Akkad","Hammurabi","Nabuchodonosor II","Assurbanipal"], answer:[2]},
        { id:'q44', type:'QCS', question:"Quel Ã©noncÃ© dÃ©crit le mieux une 'ziggurat' ?", options:["Tombe royale souterraine","Plate-forme temple surÃ©levÃ©e","Maison urbaine traditionnelle","Hangar industriel"], answer:[1]},
        { id:'q45', type:'QCS', question:"Le systÃ¨me d'Ã©criture utilisÃ© largement en MÃ©sopotamie est :", options:["HiÃ©roglyphes","CunÃ©iforme","Alphabet phÃ©nicien","LinÃ©aire B"], answer:[1]},
        { id:'q46', type:'QCS', question:"Quel site est souvent citÃ© comme l'une des premiÃ¨res villes d'Uruk ?", options:["Gizeh","Ã‡atal HÃ¶yÃ¼k","Uruk elle-mÃªme","Knossos"], answer:[2]},
        { id:'q47', type:'QCS', question:"Les temples mÃ©sopotamiens servaient principalement Ã  :", options:["RÃ©sider le roi en permanence","CÃ©rÃ©monies religieuses et stockage Ã©conomique","Habitat collectif","UniversitÃ©"], answer:[1]},
        { id:'q48', type:'QCS', question:"Quel matÃ©riau permettait la polychromie durable sur faÃ§ades ?", options:["Brique Ã©maillÃ©e (glazed bricks)","Enduit en plÃ¢tre blanc","Peinture Ã  l'huile","Papier peint"], answer:[0]},
        { id:'q49', type:'QCS', question:"Quel plan est caractÃ©ristique des palais assyriens ?", options:["Plan centralisÃ© en cour","Plan axial avec salles successives","Plan circulaire","Plan en croix grecque"], answer:[1]},
        { id:'q50', type:'QCS', question:"L'eau dans les citÃ©s mÃ©sopotamiennes Ã©tait gÃ©rÃ©e par :", options:["Des aqueducs en pierre comme Rome","Canaux et bassins d'irrigation","Puits artÃ©siens modernes","Siphons hydraulique avancÃ©s"], answer:[1]},
        { id:'q51', type:'QCS', question:"Quel type de voÃ»te Ã©tait le plus courant pour les larges espaces en brique ?", options:["VoÃ»te en plein cintre romaine","VoÃ»te en encorbellement (corbeled)","VoÃ»te nervurÃ©e gothique","VoÃ»te lambrissÃ©e en bois"], answer:[1]},
        { id:'q52', type:'QCS', question:"Les bas-reliefs assyriens reprÃ©sentent surtout :", options:["ScÃ¨nes de la vie domestique","Campagnes militaires et chasses royales","Mythes agricoles uniquement","PÃ©riodes astronomiques"], answer:[1]},
        { id:'q53', type:'QCS', question:"Quel rÃ´le urbain avait la place du temple Ã  Nippur ?", options:["Centre religieux majeur et administratif","Aire rÃ©sidentielle de l'aristocratie","Zone d'artisanat intensif","Place de marchÃ© uniquement"], answer:[0]},
        { id:'q54', type:'QCS', question:"Le terme 'tell' (monticule) est liÃ© Ã  :", options:["Accumulation stratifiÃ©e d'occupations","Type de construction en pierre","SystÃ¨me d'irrigation","Ã‰difice religieux spÃ©cifique"], answer:[0]},
        { id:'q55', type:'QCS', question:"Quel peuple est cÃ©lÃ¨bre pour ses palais monumentaux Ã  Nimrud et Khorsabad ?", options:["SumÃ©riens","Babyloniens","Assyriens","Hittites"], answer:[2]},
        { id:'q56', type:'QCS', question:"La richesse des dÃ©corations en briques Ã©maillÃ©es est surtout associÃ©e Ã  :", options:["PÃ©riode nÃ©olithique","Babylonie nÃ©o-babylonienne","Empire romain","PÃ©riode hellÃ©nistique"], answer:[1]},
        { id:'q57', type:'QCS', question:"Quel usage principal des tablettes cunÃ©iformes influence notre connaissance architecturale ?", options:["Inventaires et contrats de construction","PoÃ¨mes Ã©piques","Recettes culinaires","Calendriers rituels uniquement"], answer:[0]},
        { id:'q58', type:'QCS', question:"Les portes monumentales babyloniennes comportaient souvent :", options:["Statues en bronze grandeur nature","Reliefs d'animaux mythiques","Vitraux colorÃ©s","FenÃªtres en verre"], answer:[1]},
        { id:'q59', type:'QCS', question:"La gestion des surplus agricoles par le temple entraÃ®nait :", options:["DÃ©veloppement d'entrepÃ´ts et silos","Disparition du commerce interrÃ©gional","Construction en pierre uniquement","Diminution de la population urbaine"], answer:[0]},
        { id:'q60', type:'QCS', question:"Quel rite influenÃ§ait le plan cÃ©rÃ©moniel des ziggurats ?", options:["Processions menant au sommet","FunÃ©railles royales en surface","AgrÃ©gation des maisons autour d'un puits","Danse de la moisson"], answer:[0]},

        /* ----- VF 61..90 (Vrai/Faux) ----- */
        { id:'q61', type:'VF', question:"Les ziggurats Ã©taient des tombes pour les rois.", options:["Vrai","Faux"], answer:[1]},
        { id:'q62', type:'VF', question:"La brique crue (mudbrick) Ã©tait le matÃ©riau le plus courant.", options:["Vrai","Faux"], answer:[0]},
        { id:'q63', type:'VF', question:"Les portes d'Ishtar de Babylone sont dÃ©corÃ©es de brique Ã©maillÃ©e polychrome.", options:["Vrai","Faux"], answer:[0]},
        { id:'q64', type:'VF', question:"Les citÃ©s mÃ©sopotamiennes n'avaient aucune administration centralisÃ©e.", options:["Vrai","Faux"], answer:[1]},
        { id:'q65', type:'VF', question:"Les plans des palais assyriens sont souvent organisÃ©s selon un axe cÃ©rÃ©moniel.", options:["Vrai","Faux"], answer:[0]},
        { id:'q66', type:'VF', question:"Les MÃ©sopotamiens utilisaient le bÃ©ton comme les Romains.", options:["Vrai","Faux"], answer:[1]},
        { id:'q67', type:'VF', question:"Les canaux mÃ©sopotamiens servaient uniquement pour l'irrigation.", options:["Vrai","Faux"], answer:[1]},
        { id:'q68', type:'VF', question:"Les bas-reliefs assyriens Ã©taient placÃ©s principalement dans des espaces publics et palatiaux.", options:["Vrai","Faux"], answer:[0]},
        { id:'q69', type:'VF', question:"Les villes mÃ©sopotamiennes Ã©taient toutes planifiÃ©es selon un quadrillage orthogonal strict.", options:["Vrai","Faux"], answer:[1]},
        { id:'q70', type:'VF', question:"Les temples mÃ©sopotamiens associaient fonctions rituelles et Ã©conomiques.", options:["Vrai","Faux"], answer:[0]},
        { id:'q71', type:'VF', question:"Les murailles de villes pouvaient atteindre plusieurs dizaines de mÃ¨tres d'Ã©paisseur.", options:["Vrai","Faux"], answer:[1]},
        { id:'q72', type:'VF', question:"Les artisans et ateliers Ã©taient souvent rattachÃ©s au temple ou au palais.", options:["Vrai","Faux"], answer:[0]},
        { id:'q73', type:'VF', question:"Les techniques de construction Ã©taient uniformes sur l'ensemble de la MÃ©sopotamie sans variation rÃ©gionale.", options:["Vrai","Faux"], answer:[1]},
        { id:'q74', type:'VF', question:"Les ziggurats comportaient un accÃ¨s public libre jusqu'au sommet pour tous.", options:["Vrai","Faux"], answer:[1]},
        { id:'q75', type:'VF', question:"La documentation cunÃ©iforme a permis de reconstituer des contrats de construction.", options:["Vrai","Faux"], answer:[0]},
        { id:'q76', type:'VF', question:"Le climat et les crues du Tigre et de l'Euphrate n'influaient pas sur l'architecture.", options:["Vrai","Faux"], answer:[1]},
        { id:'q77', type:'VF', question:"L'emploi de briques cuites a permis des ornements durables sur les faÃ§ades.", options:["Vrai","Faux"], answer:[0]},
        { id:'q78', type:'VF', question:"Les palais assyriens sont dÃ©pourvus d'inscriptions royales.", options:["Vrai","Faux"], answer:[1]},
        { id:'q79', type:'VF', question:"Les techniques mÃ©sopotamiennes n'ont eu aucune influence sur l'architecture des rÃ©gions voisines.", options:["Vrai","Faux"], answer:[1]},
        { id:'q80', type:'VF', question:"La notion de citÃ©-Ã‰tat est centrale dans l'histoire urbaine mÃ©sopotamienne.", options:["Vrai","Faux"], answer:[0]},
        
        /* ----- QCM 81..90 (mix hard extra) ----- */
        { id:'q81', type:'QCM', question:"Quels facteurs expliquent la monumentalitÃ© de certains Ã©difices mÃ©sopotamiens ?", options:["CompÃ©tition entre citÃ©s","Affirmation du pouvoir royal","CapacitÃ© technique et ressources","NÃ©cessitÃ© agricole"], answer:[0,1,2]},
        { id:'q82', type:'QCM', question:"Quels signes de planification urbaine complexe observe-t-on ?", options:["RÃ©seaux de canaux intÃ©grÃ©s","RÃ©partition zonale des fonctions (temple, palais, habitations)","PrÃ©sence d'infrastructures routiÃ¨res pavÃ©es Ã  l'Ã©chelle rÃ©gionale","Usage systÃ©matique d'Ã©purations sanitaires modernes"], answer:[0,1]},
        { id:'q83', type:'QCM', question:"Quels Ã©lÃ©ments de sÃ©curitÃ© urbaine sont attestÃ©s ?", options:["Tours et bastions","Portes monumentales contrÃ´lÃ©es","SystÃ¨mes de verrous mÃ©talliques complexes","FossÃ©s et contre-fossÃ©s"], answer:[0,1,3]},
        { id:'q84', type:'QCM', question:"Quelles missions de l'architecte/maÃ®tre d'Å“uvre apparaissent dans les tablettes ?", options:["Gestion des approvisionnements","Supervision de main d'Å“uvre","Conception symbolique","Calculs structuraux modernes"], answer:[0,1,2]},
        { id:'q85', type:'QCM', question:"Quels types d'ornements racontent un rÃ©cit mythologique ?", options:["Bas-reliefs narratifs","StÃ¨les inscrites","Briques moulÃ©es illustrÃ©es","FenÃªtres vitrÃ©es illustrÃ©es"], answer:[0,1,2]},
        { id:'q86', type:'QCM', question:"Quelles consÃ©quences architecturales de l'Ã©conomie centralisÃ©e ?", options:["Grandes rÃ©serves et entrepÃ´ts","Standardisation des modules de construction","Investissements dans monuments publics","Diminution des habitats privÃ©s"], answer:[0,1,2]},
        { id:'q87', type:'QCM', question:"Quels Ã©lÃ©ments techniques pouvaient amÃ©liorer la durabilitÃ© des murs en brique crue ?", options:["Enduit bitumineux","Succession de couches de briques cuites","Fondations en pierre","SÃ©chage naturel long"], answer:[0,2]},
        { id:'q88', type:'QCM', question:"Quels aspects de l'architecture mÃ©sopotamienne servent aujourd'hui d'information pour la gÃ©nie civil ?", options:["Techniques de drainage et gestion des eaux","Ã‰tude de la rÃ©sistance des voÃ»tes en encorbellement","Principes de la stratification urbaine","Calculs de structure en bÃ©ton armÃ©"], answer:[0,1,2]},
        { id:'q89', type:'QCM', question:"Quels matÃ©riaux servaient pour les fondations des bÃ¢timents monumentaux ?", options:["Briques cuites","Pierres de riviÃ¨re","Tapis de roseaux","Sable compactÃ©"], answer:[0,1]},
        { id:'q90', type:'QCM', question:"Quelles sont les caractÃ©ristiques de l'architecture domestique ?", options:["FaÃ§ades aveugles sur la rue","Organisation autour d'une cour","Absence de fenÃªtres sur l'extÃ©rieur","Plans standardisÃ©s rigides"], answer:[0,1,2]},

        /* ----- QCS 91..100 (mix hard extra) ----- */
        { id:'q91', type:'QCS', question:"Quel peuple a construit les jardins suspendus de Babylone, l'une des Sept Merveilles du Monde antique ?", options:["SumÃ©riens","Assyriens","Akkadiens","Babyloniens"], answer:[3]},
        { id:'q92', type:'QCS', question:"L'architecture mÃ©sopotamienne a Ã©tÃ© principalement influencÃ©e par :", options:["La disponibilitÃ© de la pierre","La technologie du verre","L'abondance de l'argile","L'ingÃ©nierie du mÃ©tal"], answer:[2]},
        { id:'q93', type:'QCS', question:"Quelle technique Ã©tait couramment utilisÃ©e pour la construction de voÃ»tes sans coffrage de bois ?", options:["VoÃ»te en plein cintre","VoÃ»te en encorbellement","VoÃ»te d'ogives","VoÃ»te en berceau"], answer:[1]},
        { id:'q94', type:'QCS', question:"Le tell est un monticule crÃ©Ã© par l'accumulation de :", options:["SÃ©diments fluviaux","MatÃ©riaux de construction","Cendres volcaniques","Ruines de villes superposÃ©es"], answer:[3]},
        { id:'q95', type:'QCS', question:"Quel Ã©tait le rÃ´le principal de la cour intÃ©rieure dans une maison mÃ©sopotamienne ?", options:["Espace de rÃ©ception public","Cuisine collective","Source de lumiÃ¨re et ventilation","Garage"], answer:[2]},
        { id:'q96', type:'QCS', question:"Les bas-reliefs assyriens servaient de support pour :", options:["L'art abstrait","La propagande royale","Les scÃ¨nes de vie quotidienne","Les cartes gÃ©ographiques"], answer:[1]},
        { id:'q97', type:'QCS', question:"Quel est le nom de la porte monumentale de Babylone ?", options:["Porte du Soleil","Porte d'Ishtar","Porte de l'Ã‰ternitÃ©","Porte de Sargon"], answer:[1]},
        { id:'q98', type:'QCS', question:"Quelle fonction n'Ã©tait pas associÃ©e au temple ?", options:["Centre religieux","Banque","EntrepÃ´t de cÃ©rÃ©ales","RÃ©sidence du peuple"], answer:[3]},
        { id:'q99', type:'QCS', question:"L'architecture mÃ©sopotamienne Ã©tait principalement une architecture de :", options:["Pierre","Brique crue et cuite","Bois","MÃ©tal"], answer:[1]},
        { id:'q100', type:'QCS', question:"Quel Ã©lÃ©ment architectural n'Ã©tait pas courant dans les bÃ¢timents mÃ©sopotamiens ?", options:["Arcs et voÃ»tes","Murs Ã©pais","Colonnes en pierre","Ziggurats"], answer:[2]},
    ];

    /* Quiz State Management */
    let answeredQuestions = new Set();

    /* Helper Functions */
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function startTimer() {
        if (timer) clearInterval(timer);
        timer = setInterval(() => {
            timeLeft--;
            const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');
            const seconds = String(timeLeft % 60).padStart(2, '0');
            timerDisplay.textContent = `${minutes}:${seconds}`;
            if (timeLeft <= 0) {
                endQuiz();
            }
        }, 1000);
    }

    function stopTimer() {
        if (timer) clearInterval(timer);
    }

    function createOptions(question) {
        optionsContainer.innerHTML = '';
        const inputType = question.type === 'QCM' ? 'checkbox' : 'radio';
        question.options.forEach((option, index) => {
            const optionDiv = document.createElement('label');
            optionDiv.className = 'option';
            optionDiv.innerHTML = `
                <input type="${inputType}" name="question${question.id}" value="${index}">
                <span>${option}</span>
            `;
            optionsContainer.appendChild(optionDiv);
        });
    }

    function showQuestion(index) {
        if (index >= 0 && index < currentSet.length) {
            currentIndex = index;
            const question = currentSet[currentIndex];
            questionIndex.textContent = `Question ${currentIndex + 1} / ${currentSet.length}`;
            questionText.textContent = question.question;
            createOptions(question);
            
            // Check for previous answers and mark them
            const prevAnswer = answers.find(a => a.id === question.id);
            if (prevAnswer) {
                prevAnswer.userAnswer.forEach(ansIndex => {
                    const input = optionsContainer.querySelector(`input[value="${ansIndex}"]`);
                    if (input) input.checked = true;
                });
            }

            // Update button states
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === currentSet.length - 1;
            submitBtn.style.display = 'none';
        }
        if (currentIndex === currentSet.length - 1) {
            submitBtn.style.display = 'block';
        } else {
            submitBtn.style.display = 'none';
        }
    }

    function saveAnswer() {
        const question = currentSet[currentIndex];
        const selectedOptions = Array.from(optionsContainer.querySelectorAll('input:checked')).map(input => parseInt(input.value));
        
        const existingAnswerIndex = answers.findIndex(a => a.id === question.id);
        const isCorrect = (JSON.stringify(selectedOptions.sort()) === JSON.stringify(question.answer.sort()));

        if (existingAnswerIndex > -1) {
            answers[existingAnswerIndex] = { ...question, userAnswer: selectedOptions, isCorrect };
        } else {
            answers.push({ ...question, userAnswer: selectedOptions, isCorrect });
        }
        answeredQuestions.add(question.id);
        updateRemainingQuestions();
    }

    function updateRemainingQuestions() {
        remainingQuestionsLabel.textContent = allQuestions.length - answeredQuestions.size;
    }

    function checkAnswers() {
        stopTimer();
        score = 0;
        wrongQuestions = [];

        answers.forEach(answer => {
            if (answer.isCorrect) {
                score++;
            } else {
                wrongQuestions.push(answer);
            }
        });

        scoreDisplay.textContent = score;
        showResult();
    }

    function showResult() {
        quizModal.querySelector('.quiz-body').style.display = 'none';
        resultArea.style.display = 'block';
        resultSummary.textContent = `Votre score est de ${score} sur ${answers.length}.`;
        
        answersList.innerHTML = '';
        answers.forEach(item => {
            const resultItem = document.createElement('div');
            resultItem.className = 'answer-item';
            const statusIcon = item.isCorrect ? 'âœ…' : 'âŒ';
            const userAnswerText = item.userAnswer.map(i => item.options[i]).join(', ');
            const correctAnswerText = item.answer.map(i => item.options[i]).join(', ');
            resultItem.innerHTML = `
                <b>${statusIcon} ${item.question}</b>
                <p>Votre rÃ©ponse: ${userAnswerText || 'Aucune'}</p>
                <p>Bonne rÃ©ponse: ${correctAnswerText}</p>
            `;
            answersList.appendChild(resultItem);
        });

        retryBtn.style.display = wrongQuestions.length > 0 ? 'block' : 'none';
    }

    function resetQuiz() {
        currentSet = [];
        currentIndex = 0;
        answers = [];
        score = 0;
        timeLeft = 30 * 60;
        wrongQuestions = [];
        retryMode = false;
        answeredQuestions.clear();

        scoreDisplay.textContent = '0';
        timerDisplay.textContent = '30:00';
        resultArea.style.display = 'none';
        quizModal.querySelector('.quiz-body').style.display = 'grid';
        startBtn.style.display = 'block';
        quizTypeSelect.disabled = false;
        endEarlyBtn.style.display = 'none';
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        submitBtn.style.display = 'none';
        optionsContainer.innerHTML = '';
        questionText.textContent = 'Choisissez un type puis dÃ©marrez.';
        questionIndex.textContent = 'Question â€” / â€”';
        remainingQuestionsLabel.textContent = '100';
    }

    function startNewQuiz(questions) {
        currentSet = questions;
        shuffleArray(currentSet);
        totalQuestionsLabel.textContent = currentSet.length;
        remainingQuestionsLabel.textContent = currentSet.length;
        currentIndex = 0;
        answers = [];
        score = 0;
        timeLeft = 30 * 60;
        retryMode = false;
        answeredQuestions.clear();

        quizModal.querySelector('.quiz-body').style.display = 'grid';
        resultArea.style.display = 'none';
        startBtn.style.display = 'none';
        endEarlyBtn.style.display = 'inline-block';
        quizTypeSelect.disabled = true;
        
        showQuestion(currentIndex);
        startTimer();
    }

    function startRetryQuiz() {
        if (wrongQuestions.length === 0) return;
        
        currentSet = wrongQuestions;
        shuffleArray(currentSet);
        totalQuestionsLabel.textContent = currentSet.length;
        remainingQuestionsLabel.textContent = currentSet.length;
        currentIndex = 0;
        answers = [];
        score = 0;
        timeLeft = 30 * 60;
        retryMode = true;
        answeredQuestions.clear();

        quizModal.querySelector('.quiz-body').style.display = 'grid';
        resultArea.style.display = 'none';
        startBtn.style.display = 'none';
        endEarlyBtn.style.display = 'inline-block';
        quizTypeSelect.disabled = true;

        showQuestion(currentIndex);
        startTimer();
    }

    /* Event Listeners */
    openQuizBtn.addEventListener('click', () => {
        resetQuiz();
        quizModal.style.display = 'flex';
        quizModal.setAttribute('aria-hidden', 'false');
    });

    closeQuizBtn.addEventListener('click', () => {
        stopTimer();
        quizModal.style.display = 'none';
        quizModal.setAttribute('aria-hidden', 'true');
    });

    closeResultBtn.addEventListener('click', () => {
        quizModal.style.display = 'none';
        quizModal.setAttribute('aria-hidden', 'true');
    });

    startBtn.addEventListener('click', () => {
        const selectedType = quizTypeSelect.value;
        const questionsOfType = allQuestions.filter(q => q.type === selectedType);
        selectedTypeLabel.textContent = selectedType;
        startNewQuiz(questionsOfType);
    });

    endEarlyBtn.addEventListener('click', () => {
        saveAnswer();
        checkAnswers();
    });

    prevBtn.addEventListener('click', () => {
        saveAnswer();
        showQuestion(currentIndex - 1);
    });

    nextBtn.addEventListener('click', () => {
        saveAnswer();
        showQuestion(currentIndex + 1);
    });

    submitBtn.addEventListener('click', () => {
        saveAnswer();
        checkAnswers();
    });

    retryBtn.addEventListener('click', () => {
        startRetryQuiz();
    });

    document.addEventListener('keydown', (e) => {
        if (quizModal.style.display === 'flex') {
            if (e.key === 'ArrowRight' && !nextBtn.disabled) {
                nextBtn.click();
            } else if (e.key === 'ArrowLeft' && !prevBtn.disabled) {
                prevBtn.click();
            }
        }
    });

    // Initial state setup on load
    resetQuiz();
</script>

</body>
</html>
