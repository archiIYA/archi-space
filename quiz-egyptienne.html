<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Quiz ‚Äì Architecture √©gyptienne (100 Q) - Fixed</title>
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1: #fff6d6;
    --bg2: #ffe0b2;
    --accent1: #ffcc00;
    --accent2: #ff9900;
    --card-bg: rgba(255,255,255,0.95);
    --muted: #666;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Rubik',sans-serif;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    color:#111;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* SIDEBAR */
  aside{
    width:260px;
    background:#fff;
    height:100vh;
    padding:18px;
    box-shadow:2px 0 12px rgba(0,0,0,0.08);
    position:fixed;
    left:-260px;
    top:0;
    z-index:999;
    transition:left .32s ease;
  }
  aside.active{left:0;}
  aside h3{margin:6px 0 12px;font-size:16px}
  aside a.btn{
    display:block;
    text-decoration:none;
    background:var(--accent1);
    color:#000;
    padding:10px 12px;
    border-radius:8px;
    font-weight:600;
    box-shadow:2px 4px 10px rgba(0,0,0,0.12);
    text-align:center;
    margin-bottom:10px;
  }
  aside .mini{
    font-size:13px;color:var(--muted);
    margin-top:14px;
    line-height:1.5;
  }

  /* MAIN */
  main{
    transition:margin-left .32s ease;
    padding:18px;
    margin-left:0;
    min-height:100vh;
  }
  main.shifted{margin-left:260px;}
  .topbar{
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:12px;
  }
  .menu-btn{
    background:var(--accent1);
    border:none;
    padding:10px 14px;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    box-shadow:2px 4px 12px rgba(0,0,0,0.12);
  }
  .title{
    font-size:20px;
    margin:0;
  }

  /* settings and timer */
  .controls{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    margin:12px 0 18px;
  }
  select,input[type="number"]{padding:8px 10px;border-radius:8px;border:1px solid #ddd}
  .quiz-btn{
    background:var(--accent1);
    border:none;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer;
    box-shadow:2px 4px 10px rgba(0,0,0,0.12);
  }
  .quiz-btn.warn{background:#ff6b6b;color:#fff}

  /* timer circle */
  .timer-area{display:flex;gap:18px;align-items:center}
  .timer-wrapper{width:110px;height:110px;position:relative}
  .timer-wrapper svg{transform:rotate(-90deg)}
  .timer-text{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    font-weight:800;font-size:14px;text-align:center;
  }
  .timer-sub{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}

  /* quiz */
  #quiz-container{display:block;margin-top:14px}
  .question-card{
    background:var(--card-bg);
    border-radius:12px;
    padding:14px;
    margin-bottom:14px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    animation:cardIn .36s ease both;
  }
  @keyframes cardIn{
    from{opacity:0;transform:translateY(8px)}
    to{opacity:1;transform:translateY(0)}
  }
  .q-header{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .q-title{font-weight:700}
  .q-sub{font-size:13px;color:var(--muted)}
  .choices{margin-top:10px;display:block}
  .choices label{
    display:block;padding:8px 10px;border-radius:8px;margin-bottom:8px;border:1px solid #eee;
    cursor:pointer;
  }
  .choices input{margin-right:8px}
  .small-note{font-size:13px;color:var(--muted);margin-top:8px}

  /* footer submit box */
  .submit-box{
    position:sticky;bottom:12px;background:transparent;padding:8px 0;display:flex;gap:12px;justify-content:space-between;align-items:center;
  }
  .result-pill{background:#fff;padding:10px 12px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);font-weight:700}
  .submit-btn{background:var(--accent2);border:none;color:#fff;padding:12px 18px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:2px 6px 20px rgba(0,0,0,0.12)}
  .clear-btn{background:#fff;border:1px solid #ddd;padding:10px 12px;border-radius:10px;cursor:pointer}

  /* responsive */
  @media(max-width:900px){
    aside{left:-260px}
    aside.active{left:0}
    main.shifted{margin-left:0} /* on small screens we let aside overlay */
    .timer-wrapper{width:90px;height:90px}
    .title{font-size:18px}
  }

  @media(max-width:520px){
    .choices label{font-size:14px;padding:10px}
    .menu-btn{padding:8px 10px}
    .timer-text{font-size:13px}
  }
</style>
</head>
<body>

<!-- Sidebar -->
<aside id="sidebar">
  <h3>üìö ArchiSpace ‚Äî Quiz</h3>
  <a class="btn" href="histoire1.html">üîô Retour</a>
  <div class="mini">
    <strong>Sujet:</strong> Architecture √©gyptienne (100 questions)<br>
    <strong>Niveaux:</strong> QCM / QCS / Vrai-Faux<br>
    <strong>Conseil:</strong> ÿßÿ∂ÿ∫ÿ∑ Commencer ÿ´ŸÖ Answer all and Submit.
  </div>
</aside>

<!-- Main -->
<main id="main-content">
  <div class="topbar">
    <button class="menu-btn" id="menuToggle">‚ò∞ Menu</button>
    <h1 class="title">üèõ Quiz ‚Äì Architecture √©gyptienne (100 questions)</h1>
  </div>

  <div class="controls">
    <div>
      <label>üåê Langue / Language</label><br>
      <select id="lang">
        <option value="fr">Fran√ßais</option>
        <option value="en">English</option>
      </select>
    </div>

    <div>
      <label>‚è± Dur√©e (minutes)</label><br>
      <input type="number" id="duration" value="45" min="5" max="180"/>
    </div>

    <div style="align-self:flex-end">
      <button class="quiz-btn" id="startBtn">Commencer / Start</button>
      <button class="quiz-btn warn" id="resetBtn" title="R√©initialiser les r√©ponses">R√©initialiser</button>
    </div>

    <div style="margin-left:auto" class="timer-area">
      <div class="timer-wrapper" title="Temps restant">
        <svg width="110" height="110">
          <defs>
            <linearGradient id="g1" x1="0" x2="1">
              <stop offset="0%" stop-color="#ffcc00"/>
              <stop offset="100%" stop-color="#ff6b00"/>
            </linearGradient>
          </defs>
          <circle cx="55" cy="55" r="48" stroke="#eee" stroke-width="8" fill="none"></circle>
          <circle id="progress" cx="55" cy="55" r="48" stroke="url(#g1)" stroke-width="8" stroke-linecap="round" fill="none"></circle>
        </svg>
        <div class="timer-text" id="timerText">00:00</div>
      </div>
      <div style="text-align:left">
        <div class="timer-sub" id="timerLabel">Pr√™t / Ready</div>
        <div style="font-size:13px;color:var(--muted);margin-top:6px">Questions: <strong>100</strong></div>
      </div>
    </div>
  </div>

  <div id="quiz-container">
    <!-- Questions will be injected here -->
  </div>

  <div class="submit-box" id="submit-area" style="display:none">
    <div class="result-pill" id="summary">Pr√™t √† d√©marrer</div>
    <div style="display:flex;gap:8px">
      <button class="clear-btn" id="scrollTop">Aller au d√©but</button>
      <button class="submit-btn" id="submitBtn">üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± / Submit</button>
    </div>
  </div>

</main>

<script>
/* ========= QUESTIONS base (a few explicit) =========
   We'll then extend programmatically to ensure 100 valid items.
*/
const ALL_QUESTIONS = [
  {
    q_fr:"Quelle pyramide est attribu√©e √† Kh√©ops (Khoufou) ?",
    q_en:"Which pyramid is attributed to Khufu (Khufu)?",
    type:"qcm",
    choices_fr:["Grande pyramide de Kh√©ops","Pyramide de Djoser","Pyramide de Myk√©rinos"],
    choices_en:["Great Pyramid of Khufu","Pyramid of Djoser","Pyramid of Menkaure"],
    answer:[0]
  },
  {
    q_fr:"Quel architecte est associ√© √† la pyramide √† degr√©s de Dj√©ser ?",
    q_en:"Which architect is associated with Djoser's step pyramid?",
    type:"qcm",
    choices_fr:["Imhotep","Horemheb","Kh√©ops"],
    choices_en:["Imhotep","Horemheb","Khufu"],
    answer:[0]
  },
  {
    q_fr:"O√π se situe la pyramide √† degr√©s de Dj√©ser ?",
    q_en:"Where is Djoser's step pyramid located?",
    type:"qcm",
    choices_fr:["Saqqara","Gizeh","Abydos"],
    choices_en:["Saqqara","Giza","Abydos"],
    answer:[0]
  },
  {
    q_fr:"Le 'serdab' sert principalement √† :",
    q_en:"The 'serdab' is mainly used to:",
    type:"qcm",
    choices_fr:["Abriter la statue du d√©funt","Stocker l'eau","Loger les pr√™tres"],
    choices_en:["House the statue of the deceased","Store water","Lodge priests"],
    answer:[0]
  },
  {
    q_fr:"Les colonnes hathoriques sont associ√©es √† quelle divinit√© ?",
    q_en:"Hathoric columns are associated with which deity?",
    type:"qcm",
    choices_fr:["Hathor","R√™","Osiris"],
    choices_en:["Hathor","Ra","Osiris"],
    answer:[0]
  },
  {
    q_fr:"Les rampes sont √©voqu√©es pour quel usage dans la construction des pyramides ?",
    q_en:"Ramps are mentioned for which use in pyramid construction?",
    type:"qcm",
    choices_fr:["Monter les blocs de pierre","Orner les fa√ßades","Assurer l'√©vacuation des eaux"],
    choices_en:["Raising stone blocks","Decorating facades","Ensuring water drainage"],
    answer:[0]
  },
  {
    q_fr:"Quel mat√©riau √©tait fr√©quemment employ√© pour les monuments royaux ?",
    q_en:"Which material was frequently used for royal monuments?",
    type:"qcm",
    choices_fr:["Calcaire et granit","Bois","Briques crues seulement"],
    choices_en:["Limestone and granite","Wood","Mudbricks only"],
    answer:[0]
  },
  {
    q_fr:"Le plan-type d'un temple √©gyptien comporte souvent :",
    q_en:"A typical Egyptian temple plan often includes:",
    type:"qcm",
    choices_fr:["Cour, salle hypostyle, sanctuaire","Nef centrale et bas-c√¥t√©s","Plan radial concentrique"],
    choices_en:["Court, hypostyle hall, sanctuary","Central nave and aisles","Concentric radial plan"],
    answer:[0]
  },
  {
    q_fr:"Le mastaba est principalement un :",
    q_en:"The mastaba is primarily a:",
    type:"qcm",
    choices_fr:["Tombeau","Palais","Entrep√¥t"],
    choices_en:["Tomb","Palace","Storehouse"],
    answer:[0]
  },
  {
    q_fr:"La disposition des rues dans les villes √©gyptiennes cherchait surtout √† :",
    q_en:"The layout of streets in Egyptian towns mainly aimed to:",
    type:"qcm",
    choices_fr:["Cr√©er de l'ombre et profiter du vent","Agrandir les places publiques","Afficher des motifs d√©coratifs"],
    choices_en:["Create shade and use prevailing winds","Enlarge public squares","Display decorative patterns"],
    answer:[0]
  },
  {
    q_fr:"Parmi ces √©l√©ments, lesquels sont typiques des colonnes √©gyptiennes ?",
    q_en:"Which of these elements are typical of Egyptian columns?",
    type:"qcs",
    choices_fr:["Chapiteaux en lotus ou papyrus","F√ªts cannel√©s √† la romaine","D√©cors peints et reliefs"],
    choices_en:["Lotus or papyrus capitals","Roman-style fluted shafts","Painted decorations and reliefs"],
    answer:[0,2]
  },
  {
    q_fr:"La pyramide √† degr√©s de Dj√©ser a √©t√© con√ßue pour quel roi ?",
    q_en:"Djoser's step pyramid was built for which king?",
    type:"qcm",
    choices_fr:["Dj√©ser","Kh√©ops","Touthm√¥sis"],
    choices_en:["Djoser","Khufu","Thutmose"],
    answer:[0]
  },
  {
    q_fr:"Les hypog√©es d√©signent :",
    q_en:"Hypogea refer to:",
    type:"qcm",
    choices_fr:["Tombeaux creus√©s dans la roche","Murs d'enceinte","Temples solaires"],
    choices_en:["Tombs cut into rock","Defensive walls","Sun temples"],
    answer:[0]
  },
  {
    q_fr:"Vrai ou Faux : Les √âgyptiens n'utilisaient jamais la brique crue.",
    q_en:"True or False: Egyptians never used mudbrick.",
    type:"vf",
    answer:false
  },
  {
    q_fr:"Vrai ou Faux : Le sanctuaire est l'espace le plus int√©rieur du temple √©gyptien.",
    q_en:"True or False: The sanctuary is the innermost space of an Egyptian temple.",
    type:"vf",
    answer:true
  },
  {
    q_fr:"Quels √©l√©ments participent √† la 'progression spatiale' d'un temple ?",
    q_en:"Which elements contribute to a temple's spatial progression?",
    type:"qcs",
    choices_fr:["Cours, colonnades, salles successives","Toits en charpente m√©tallique","Escaliers ext√©rieurs monumentaux"],
    choices_en:["Courts, colonnades, successive halls","Metal framed roofs","Large external staircases"],
    answer:[0]
  },
  {
    q_fr:"Vrai ou Faux : Le serdab √©tait richement d√©cor√© int√©rieurement.",
    q_en:"True or False: The serdab was richly decorated inside.",
    type:"vf",
    answer:false
  },
  {
    q_fr:"Quel site rassemble les grandes pyramides royales (Kh√©ops, Kh√©phren, Myk√©rinos) ?",
    q_en:"Which site gathers the major royal pyramids (Khufu, Khafre, Menkaure)?",
    type:"qcm",
    choices_fr:["Gizeh","Saqqara","Abydos"],
    choices_en:["Giza","Saqqara","Abydos"],
    answer:[0]
  },
  {
    q_fr:"Le terme 'temple des millions d'ann√©es' se r√©f√®re √† :",
    q_en:"The term 'temple of millions of years' refers to:",
    type:"qcm",
    choices_fr:["Un temple fun√©raire li√© au roi","Un observatoire","Un palais royal"],
    choices_en:["A king's mortuary temple","An observatory","A royal palace"],
    answer:[0]
  },
  {
    q_fr:"Vrai ou Faux : Les fa√ßades des temples √©gyptiens privil√©gient la l√©g√®ret√© sculpturale plut√¥t que les masses.",
    q_en:"True or False: Egyptian temple facades favor sculptural lightness over massiveness.",
    type:"vf",
    answer:false
  }
];

/* ========= Extend to 100 items programmatically (valid structures) ========= */
(function fillTo100(){
  const qCount = ALL_QUESTIONS.length;
  const needed = 100 - qCount;
  const qcmPool = [
    { q_fr:"Quelle est la fonction principale d'un mastaba ?", q_en:"What is the main function of a mastaba?", type:"qcm",
      choices_fr:["Tombeau","Fortification","Maison de commerce"], choices_en:["Tomb","Fortification","Marketplace"], answer:[0] },
    { q_fr:"Quel chapiteau imite le lotus ?", q_en:"Which capital imitates the lotus?", type:"qcm",
      choices_fr:["Lotiforme","Ionique","Corinthien"], choices_en:["Lotiform","Ionic","Corinthian"], answer:[0] },
    { q_fr:"Quel mat√©riau trouve-t-on souvent dans les temples √©gyptiens pour les colonnes ?", q_en:"Which material is often found in temple columns?",
      type:"qcm", choices_fr:["Pierre sculpt√©e","Bois massif","Brique crue"], choices_en:["Carved stone","Solid wood","Mudbrick"], answer:[0] },
    { q_fr:"Quel √©l√©ment sert de passage entre la pyramide et le temple de la vall√©e ?", q_en:"What links the pyramid to the valley temple?",
      type:"qcm", choices_fr:["Chauss√©e","Aqueduc","Canal d√©coratif"], choices_en:["Causeway","Aqueduct","Decorative channel"], answer:[0] },
    { q_fr:"Quel ordre de colonnes n'est pas √©gyptien ?", q_en:"Which column order is NOT Egyptian?",
      type:"qcm", choices_fr:["Ionique","Hathorique","Papyriforme"], choices_en:["Ionic","Hathoric","Papyriform"], answer:[0] },
    { q_fr:"Quel est l'effet recherch√© par les surfaces lisses des pyramides ?", q_en:"What effect is sought by smooth surfaces of pyramids?",
      type:"qcm", choices_fr:["Accentuer la puret√© g√©om√©trique","Augmenter la surface d√©corative","Faciliter la v√©g√©talisation"], choices_en:["Emphasize geometric purity","Increase decorative surface","Facilitate planting"], answer:[0] },
    { q_fr:"Quel type de toit est courant dans l'habitat √©gyptien traditionnel ?", q_en:"Which roof type is common in traditional Egyptian housing?",
      type:"qcm", choices_fr:["Toit plat","Toit en pente","Toit en vo√ªte"], choices_en:["Flat roof","Pitched roof","Vaulted roof"], answer:[0] }
  ];

  const qcsPool = [
    { q_fr:"Parmi ces techniques, lesquelles √©taient utilis√©es par les √âgyptiens ?", q_en:"Which of these techniques were used by the Egyptians?",
      type:"qcs", choices_fr:["Rampes","Organisation centralis√©e","Grues hydrauliques modernes"], choices_en:["Ramps","Centralized organization","Modern hydraulic cranes"], answer:[0,1] },
    { q_fr:"Quels √©l√©ments font partie d'un complexe fun√©raire √©gyptien ?", q_en:"Which elements are part of an Egyptian funerary complex?",
      type:"qcs", choices_fr:["Chapelle","Serdab","Bassin de natation"], choices_en:["Chapel","Serdab","Swimming pool"], answer:[0,1] }
  ];

  const vfPool = [
    { q_fr:"Vrai ou Faux : Les colonnes papyriformes n'existent qu'en version ferm√©e.", q_en:"True or False: Papyriform columns exist only in closed form.", type:"vf", answer:false },
    { q_fr:"Vrai ou Faux : Les constructions en pierre visent la permanence.", q_en:"True or False: Stone constructions aim for permanence.", type:"vf", answer:true },
    { q_fr:"Vrai ou Faux : Les villes √©gyptiennes avaient toujours une grande place publique centrale.", q_en:"True or False: Egyptian towns always had a large central public square.", type:"vf", answer:false }
  ];

  let i=0;
  while (ALL_QUESTIONS.length < 100){
    // cycle through pools to mix types
    if (i % 5 === 0 && qcmPool.length){
      const item = qcmPool[i % qcmPool.length];
      // push a shallow copy
      ALL_QUESTIONS.push(JSON.parse(JSON.stringify(item)));
    } else if (i % 5 === 1 && qcsPool.length){
      const item = qcsPool[i % qcsPool.length];
      ALL_QUESTIONS.push(JSON.parse(JSON.stringify(item)));
    } else if (i % 5 === 2 && vfPool.length){
      const item = vfPool[i % vfPool.length];
      ALL_QUESTIONS.push(JSON.parse(JSON.stringify(item)));
    } else {
      // generate simple QCM variations derived from themes to ensure unique wording
      const n = ALL_QUESTIONS.length + 1;
      ALL_QUESTIONS.push({
        q_fr:`Question g√©n√©r√©e ${n}: quel √©l√©ment structurel est typique ?`,
        q_en:`Generated question ${n}: which structural element is typical?`,
        type:"qcm",
        choices_fr:["Colonne","Voute en ogive","Charpente m√©tallique"],
        choices_en:["Column","Ribbed vault","Metal frame"],
        answer:[0]
      });
    }
    i++;
    if (i>1000) break;
  }
})();

/* ======== UI & Logic ======== */
const quizContainer = document.getElementById('quiz-container');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const langEl = document.getElementById('lang');
const durationEl = document.getElementById('duration');
const progressEl = document.getElementById('progress');
const timerText = document.getElementById('timerText');
const timerLabel = document.getElementById('timerLabel');
const submitArea = document.getElementById('submit-area');
const summary = document.getElementById('summary');
const submitBtn = document.getElementById('submitBtn');
const scrollTopBtn = document.getElementById('scrollTop');
const sidebar = document.getElementById('sidebar');
const menuToggle = document.getElementById('menuToggle');
const mainContent = document.getElementById('main-content');

let timerInterval = null;
let totalSeconds = 0;
let remaining = 0;
let started = false;

// Precompute circumference for progress circle (r = 48)
const CIRCUMFERENCE = 2 * Math.PI * 48;
progressEl.style.strokeDasharray = `${CIRCUMFERENCE} ${CIRCUMFERENCE}`;
progressEl.style.strokeDashoffset = `${CIRCUMFERENCE}`;

menuToggle.addEventListener('click', ()=>{
  sidebar.classList.toggle('active');
  if (window.innerWidth > 900) mainContent.classList.toggle('shifted');
});

function formatTime(s){
  const m = Math.floor(s/60);
  const sec = s%60;
  return `${m}:${sec<10?'0':''}${sec}`;
}

function renderAllQuestions(){
  quizContainer.innerHTML = '';
  const lang = langEl.value;
  ALL_QUESTIONS.forEach((q, idx) => {
    const card = document.createElement('div');
    card.className = 'question-card';
    const qText = (lang === 'fr') ? q.q_fr : q.q_en;
    const choices = (lang === 'fr') ? q.choices_fr : q.choices_en;
    const header = document.createElement('div');
    header.className = 'q-header';
    header.innerHTML = `<div><div class="q-title">${idx+1}. ${qText}</div>
                        <div class="q-sub">${q.type.toUpperCase()} ‚Äî Question ${idx+1}</div></div>
                        <div style="text-align:right"><button class="quiz-btn" onclick="scrollToQuestion(${idx})">‚§¥</button></div>`;
    card.appendChild(header);

    const choiceBox = document.createElement('div');
    choiceBox.className = 'choices';
    if (q.type === 'qcm'){
      if (!Array.isArray(choices)) {
        // safety: if no choices array present, create placeholders
        q.choices_fr = q.choices_fr || ["R√©ponse A","R√©ponse B","R√©ponse C"];
        q.choices_en = q.choices_en || ["Answer A","Answer B","Answer C"];
      }
      (choices || []).forEach((c, ci) => {
        const id = `q_${idx}_${ci}`;
        const lab = document.createElement('label');
        lab.innerHTML = `<input type="radio" name="q_${idx}" value="${ci}" id="${id}"> ${c}`;
        choiceBox.appendChild(lab);
      });
    } else if (q.type === 'qcs'){
      (choices || []).forEach((c, ci) => {
        const id = `q_${idx}_${ci}`;
        const lab = document.createElement('label');
        lab.innerHTML = `<input type="checkbox" name="q_${idx}" value="${ci}" id="${id}"> ${c}`;
        choiceBox.appendChild(lab);
      });
    } else if (q.type === 'vf'){
      const labT = document.createElement('label');
      labT.innerHTML = `<input type="radio" name="q_${idx}" value="true"> ${lang==='fr'?'Vrai':'True'}`;
      const labF = document.createElement('label');
      labF.innerHTML = `<input type="radio" name="q_${idx}" value="false"> ${lang==='fr'?'Faux':'False'}`;
      choiceBox.appendChild(labT);
      choiceBox.appendChild(labF);
    }
    card.appendChild(choiceBox);

    const note = document.createElement('div');
    note.className = 'small-note';
    note.id = `note_${idx}`;
    card.appendChild(note);

    quizContainer.appendChild(card);
  });

  submitArea.style.display = 'flex';
  summary.textContent = 'Quiz pr√™t. Appuyez sur Submit pour corriger.';
}

function scrollToQuestion(i){
  if (i < 0) i = 0;
  const cards = document.querySelectorAll('.question-card');
  if (i >= cards.length) i = cards.length-1;
  cards[i].scrollIntoView({behavior:'smooth',block:'center'});
}

startBtn.addEventListener('click', ()=>{
  if (started){
    if (!confirm('Le test est en cours. Red√©marrer ?')) return;
    stopTimer();
  }
  renderAllQuestions();
  const mins = parseInt(durationEl.value) || 45;
  totalSeconds = mins * 60;
  remaining = totalSeconds;
  startTimer();
  started = true;
  timerLabel.textContent = 'Temps restant';
  summary.textContent = `Temps: ${mins} min ‚Äî R√©pondez √† toutes les questions puis cliquez Submit.`;
  window.scrollTo({top:0,behavior:'smooth'});
});

resetBtn.addEventListener('click', ()=>{
  if (confirm('R√©initialiser toutes vos r√©ponses ?')){
    const inputs = quizContainer.querySelectorAll('input');
    inputs.forEach(inp => inp.checked = false);
    const notes = document.querySelectorAll('.small-note');
    notes.forEach(n => n.textContent = '');
    summary.textContent = 'R√©ponses r√©initialis√©es.';
  }
});

function startTimer(){
  clearInterval(timerInterval);
  updateProgress();
  timerInterval = setInterval(()=>{
    remaining--;
    if (remaining < 0){
      clearInterval(timerInterval);
      timerText.innerText = '00:00';
      alert('Temps √©coul√© ‚Äî soumission automatique.');
      gradeQuiz();
      return;
    }
    updateProgress();
  },1000);
}

function stopTimer(){
  clearInterval(timerInterval);
  started = false;
  timerLabel.textContent = 'Arr√™t√©';
}

function updateProgress(){
  timerText.innerText = formatTime(remaining);
  const pct = remaining / totalSeconds;
  const offset = CIRCUMFERENCE * (1 - pct);
  progressEl.style.strokeDashoffset = `${offset}`;
  if (pct < 0.15){
    progressEl.style.filter = 'saturate(1.4)';
  } else {
    progressEl.style.filter = 'none';
  }
}

/* Grading */
function gradeQuiz(){
  let correctCount = 0;
  const total = ALL_QUESTIONS.length;
  ALL_QUESTIONS.forEach((q, idx) => {
    const noteEl = document.getElementById(`note_${idx}`);
    noteEl.textContent = '';
    if (q.type === 'qcm'){
      const sel = quizContainer.querySelector(`input[name="q_${idx}"]:checked`);
      if (!sel){
        noteEl.textContent = langEl.value==='fr'?'Pas de r√©ponse':'No answer';
        return;
      }
      const val = parseInt(sel.value,10);
      if (Array.isArray(q.answer) && q.answer[0] === val){
        correctCount++;
        noteEl.textContent = langEl.value==='fr'?'‚úî Correct':'‚úî Correct';
      } else {
        const correctText = (langEl.value==='fr' ? (q.choices_fr && q.choices_fr[q.answer[0]]) : (q.choices_en && q.choices_en[q.answer[0]])) || '‚Äî';
        noteEl.textContent = (langEl.value==='fr'?'‚úñ Incorrect ‚Äî R√©ponse: ':'‚úñ Incorrect ‚Äî Answer: ') + correctText;
      }
    } else if (q.type === 'qcs'){
      const boxes = quizContainer.querySelectorAll(`input[name="q_${idx}"]:checked`);
      const picked = Array.from(boxes).map(b=>parseInt(b.value,10)).sort((a,b)=>a-b);
      const correctSorted = (Array.isArray(q.answer) ? q.answer.slice().sort((a,b)=>a-b) : []);
      const ok = picked.length === correctSorted.length && picked.every((v,i)=>v===correctSorted[i]);
      if (ok){
        correctCount++;
        noteEl.textContent = langEl.value==='fr'?'‚úî Correct (toutes les bonnes)':'‚úî Correct (all correct)';
      } else {
        const corr = (langEl.value==='fr') ? (q.answer.map(i=>q.choices_fr && q.choices_fr[i]).join(', ')) : (q.answer.map(i=>q.choices_en && q.choices_en[i]).join(', '));
        noteEl.textContent = (langEl.value==='fr'?'‚úñ Incorrect ‚Äî Bonnes r√©ponses: ':'‚úñ Incorrect ‚Äî Correct answers: ') + (corr || '‚Äî');
      }
    } else if (q.type === 'vf'){
      const sel = quizContainer.querySelector(`input[name="q_${idx}"]:checked`);
      if (!sel){
        noteEl.textContent = langEl.value==='fr'?'Pas de r√©ponse':'No answer';
        return;
      }
      const val = sel.value === 'true';
      if (val === q.answer){
        correctCount++;
        noteEl.textContent = langEl.value==='fr'?'‚úî Correct':'‚úî Correct';
      } else {
        noteEl.textContent = langEl.value==='fr'?'‚úñ Incorrect':'‚úñ Incorrect';
      }
    }
  });

  const percent = Math.round((correctCount/total)*100);
  summary.textContent = (langEl.value==='fr')
    ? `R√©sultat: ${correctCount}/${total} ‚Äî ${percent}%`
    : `Result: ${correctCount}/${total} ‚Äî ${percent}%`;
  stopTimer();
  summary.scrollIntoView({behavior:'smooth',block:'center'});
}

submitBtn.addEventListener('click', ()=>{
  if (!started){
    if (!confirm('Le test n\'a pas commenc√©. Voulez-vous quand m√™me corriger les r√©ponses visibles ?')) return;
  }
  if (!confirm('√ätes-vous s√ªr de vouloir soumettre ‚Äî vous ne pourrez plus modifier vos r√©ponses ?')) return;
  gradeQuiz();
});

scrollTopBtn.addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));

/* keyboard shortcuts */
document.addEventListener('keydown',(e)=>{
  if (e.key === 'm') menuToggle.click();
  if (e.key === 's') startBtn.click();
  if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) submitBtn.click();
});

/* initialize */
timerText.innerText = '00:00';
progressEl.style.strokeDasharray = `${CIRCUMFERENCE} ${CIRCUMFERENCE}`;
progressEl.style.strokeDashoffset = `${CIRCUMFERENCE}`;

</script>
</body>
</html>
