<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Quiz ‚Äì Architecture √âgyptienne Avanc√©e (100 Q)</title>
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1: #fff6d6;
    --bg2: #ffe0b2;
    --accent1: #ffcc00;
    --accent2: #ff9900;
    --card-bg: rgba(255,255,255,0.95);
    --muted: #666;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:'Rubik',sans-serif;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    color:#111;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* SIDEBAR */
  aside{
    width:260px;
    background:#fff;
    height:100vh;
    padding:18px;
    box-shadow:2px 0 12px rgba(0,0,0,0.08);
    position:fixed;
    left:-260px;
    top:0;
    z-index:999;
    transition:left .32s ease;
  }
  aside.active{left:0;}
  aside h3{margin:6px 0 12px;font-size:16px}
  aside a.btn{
    display:block;
    text-decoration:none;
    background:var(--accent1);
    color:#000;
    padding:10px 12px;
    border-radius:8px;
    font-weight:600;
    box-shadow:2px 4px 10px rgba(0,0,0,0.12);
    text-align:center;
    margin-bottom:10px;
  }
  aside .mini{
    font-size:13px;color:var(--muted);
    margin-top:14px;
    line-height:1.5;
  }

  /* MAIN */
  main{
    transition:margin-left .32s ease;
    padding:18px;
    margin-left:0;
    min-height:100vh;
  }
  main.shifted{margin-left:260px;}
  .topbar{
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:12px;
  }
  .menu-btn{
    background:var(--accent1);
    border:none;
    padding:10px 14px;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    box-shadow:2px 4px 12px rgba(0,0,0,0.12);
  }
  .title{
    font-size:20px;
    margin:0;
  }

  /* settings and timer */
  .controls{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    margin:12px 0 18px;
  }
  select,input[type="number"]{padding:8px 10px;border-radius:8px;border:1px solid #ddd}
  .quiz-btn{
    background:var(--accent1);
    border:none;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer;
    box-shadow:2px 4px 10px rgba(0,0,0,0.12);
  }
  .quiz-btn.warn{background:#ff6b6b;color:#fff}

  /* timer circle */
  .timer-area{display:flex;gap:18px;align-items:center}
  .timer-wrapper{width:110px;height:110px;position:relative}
  .timer-wrapper svg{transform:rotate(-90deg)}
  .timer-text{
    position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
    font-weight:800;font-size:14px;text-align:center;
  }
  .timer-sub{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}

  /* quiz */
  #quiz-container{display:block;margin-top:14px}
  .question-card{
    background:var(--card-bg);
    border-radius:12px;
    padding:14px;
    margin-bottom:14px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    animation:cardIn .36s ease both;
  }
  @keyframes cardIn{
    from{opacity:0;transform:translateY(8px)}
    to{opacity:1;transform:translateY(0)}
  }
  .q-header{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .q-title{font-weight:700}
  .q-sub{font-size:13px;color:var(--muted)}
  .choices{margin-top:10px;display:block}
  .choices label{
    display:block;padding:8px 10px;border-radius:8px;margin-bottom:8px;border:1px solid #eee;
    cursor:pointer;
  }
  .choices input{margin-right:8px}
  .small-note{font-size:13px;color:var(--muted);margin-top:8px}

  /* footer submit box */
  .submit-box{
    position:sticky;bottom:12px;background:transparent;padding:8px 0;display:flex;gap:12px;justify-content:space-between;align-items:center;
  }
  .result-pill{background:#fff;padding:10px 12px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);font-weight:700}
  .submit-btn{background:var(--accent2);border:none;color:#fff;padding:12px 18px;border-radius:12px;font-weight:800;cursor:pointer;box-shadow:2px 6px 20px rgba(0,0,0,0.12)}
  .clear-btn{background:#fff;border:1px solid #ddd;padding:10px 12px;border-radius:10px;cursor:pointer}

  /* responsive */
  @media(max-width:900px){
    aside{left:-260px}
    aside.active{left:0}
    main.shifted{margin-left:0} /* on small screens we let aside overlay */
    .timer-wrapper{width:90px;height:90px}
    .title{font-size:18px}
  }

  @media(max-width:520px){
    .choices label{font-size:14px;padding:10px}
    .menu-btn{padding:8px 10px}
    .timer-text{font-size:13px}
  }
</style>
</head>
<body>

<!-- Sidebar -->
<aside id="sidebar">
  <h3>üìö ArchiSpace ‚Äî Quiz Avanc√©</h3>
  <a class="btn" href="histoire1.html">üîô Retour</a>
  <div class="mini">
    <strong>Sujet:</strong> Architecture √©gyptienne (100 questions)<br>
    <strong>Niveaux:</strong> QCM (45) | QCS (35) | VF (20)<br>
    <strong>Public:</strong> ÿ∑ŸÑÿ®ÿ© ÿßŸÑŸáŸÜÿØÿ≥ÿ© ÿßŸÑŸÖÿπŸÖÿßÿ±Ÿäÿ©
  </div>
</aside>

<!-- Main -->
<main id="main-content">
  <div class="topbar">
    <button class="menu-btn" id="menuToggle">‚ò∞ Menu</button>
    <h1 class="title">üèõ Quiz ‚Äì Architecture √âgyptienne Avanc√©e (100 questions)</h1>
  </div>

  <div class="controls">
    <div>
      <label>üåê Langue / Language</label><br>
      <select id="lang">
        <option value="fr">Fran√ßais</option>
        <option value="en">English</option>
      </select>
    </div>

    <div>
      <label>‚è± Dur√©e (minutes)</label><br>
      <input type="number" id="duration" value="45" min="5" max="180"/>
    </div>

    <div style="align-self:flex-end">
      <button class="quiz-btn" id="startBtn">Commencer / Start</button>
      <button class="quiz-btn warn" id="resetBtn" title="R√©initialiser les r√©ponses">R√©initialiser</button>
    </div>

    <div style="margin-left:auto" class="timer-area">
      <div class="timer-wrapper" title="Temps restant">
        <svg width="110" height="110">
          <defs>
            <linearGradient id="g1" x1="0" x2="1">
              <stop offset="0%" stop-color="#ffcc00"/>
              <stop offset="100%" stop-color="#ff6b00"/>
            </linearGradient>
          </defs>
          <circle cx="55" cy="55" r="48" stroke="#eee" stroke-width="8" fill="none"></circle>
          <circle id="progress" cx="55" cy="55" r="48" stroke="url(#g1)" stroke-width="8" stroke-linecap="round" fill="none"></circle>
        </svg>
        <div class="timer-text" id="timerText">00:00</div>
      </div>
      <div style="text-align:left">
        <div class="timer-sub" id="timerLabel">Pr√™t / Ready</div>
        <div style="font-size:13px;color:var(--muted);margin-top:6px">Questions: <strong>100</strong></div>
      </div>
    </div>
  </div>

  <div id="quiz-container">
    <!-- Questions will be injected here -->
  </div>

  <div class="submit-box" id="submit-area" style="display:none">
    <div class="result-pill" id="summary">Pr√™t √† d√©marrer</div>
    <div style="display:flex;gap:8px">
      <button class="clear-btn" id="scrollTop">Aller au d√©but</button>
      <button class="submit-btn" id="submitBtn">üèÅ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿßÿÆÿ™ÿ®ÿßÿ± / Submit</button>
    </div>
  </div>

</main>

<script>
/* ========= QUESTIONS ========= */
const ALL_QUESTIONS = [
  // ===== QCM (45 questions) =====
  {
    q_fr: "Quelle est la hauteur originale de la pyramide de Kh√©ops ?",
    q_en: "What was the original height of the Great Pyramid of Khufu?",
    type: "qcm",
    choices_fr: ["146.6 m√®tres", "138 m√®tres", "156 m√®tres", "120 m√®tres"],
    choices_en: ["146.6 meters", "138 meters", "156 meters", "120 meters"],
    answer: [0]
  },
  {
    q_fr: "Quel mat√©riau √©tait utilis√© pour le rev√™tement ext√©rieur des pyramides ?",
    q_en: "Which material was used for the outer casing of the pyramids?",
    type: "qcm",
    choices_fr: ["Calcaire fin de Tourah", "Granit rouge", "Gr√®s", "Basalt"],
    choices_en: ["Fine limestone from Tura", "Red granite", "Sandstone", "Basalt"],
    answer: [0]
  },
  {
    q_fr: "Quelle est la fonction principale d'un mastaba ?",
    q_en: "What is the main function of a mastaba?",
    type: "qcm",
    choices_fr: ["Tombeau", "Temple solaire", "R√©sidence royale", "Entrep√¥t"],
    choices_en: ["Tomb", "Sun temple", "Royal residence", "Storage"],
    answer: [0]
  },
  {
    q_fr: "Qu'est-ce qu'une colonne hathorique ?",
    q_en: "What is a Hathoric column?",
    type: "qcm",
    choices_fr: [
      "Colonne √† chapiteau repr√©sentant la d√©esse Hathor",
      "Colonne sans base utilis√©e dans les temples solaires",
      "Colonne dorique inspir√©e de l'art grec"
    ],
    choices_en: [
      "Column with a capital depicting goddess Hathor",
      "Base-less column used in sun temples",
      "Doric column inspired by Greek art"
    ],
    answer: [0]
  },
  {
    q_fr: "Qu'est-ce que le 'Naos' dans un temple √©gyptien ?",
    q_en: "What is the 'Naos' in an Egyptian temple?",
    type: "qcm",
    choices_fr: [
      "Le sanctuaire abritant la statue du dieu",
      "La cour √† ciel ouvert",
      "L'entr√©e monumentale du temple"
    ],
    choices_en: [
      "The sanctuary housing the god's statue",
      "The open-air courtyard",
      "The monumental entrance of the temple"
    ],
    answer: [0]
  },
  {
    q_fr: "Quelle technique √©tait principalement utilis√©e pour le transport des blocs de pierre ?",
    q_en: "Which technique was mainly used for transporting stone blocks?",
    type: "qcm",
    choices_fr: ["Rampes en brique crue", "Treuil en bois", "Tra√Æneaux sur sol mouill√©", "Tous ces √©l√©ments"],
    choices_en: ["Mudbrick ramps", "Wooden winch", "Sledges on wet soil", "All of the above"],
    answer: [3]
  },
  {
    q_fr: "Quel est l'√©l√©ment caract√©ristique d'une pyramide √† degr√©s ?",
    q_en: "What is the characteristic feature of a step pyramid?",
    type: "qcm",
    choices_fr: ["Superposition de mastabas", "Faces lisses", "Chambre fun√©raire externe", "Base circulaire"],
    choices_en: ["Superimposed mastabas", "Smooth faces", "External burial chamber", "Circular base"],
    answer: [0]
  },
  {
    q_fr: "Quelle est la fonction du 'serdab' ?",
    q_en: "What is the function of the 'serdab'?",
    type: "qcm",
    choices_fr: [
      "Abriter les statues du d√©funt",
      "Stocker les offrandes alimentaires",
      "Servir de chambre fun√©raire",
      "Abriter les textes sacr√©s"
    ],
    choices_en: [
      "House the statues of the deceased",
      "Store food offerings",
      "Serve as burial chamber",
      "House sacred texts"
    ],
    answer: [0]
  },
  {
    q_fr: "Qu'est-ce qu'un 'dromos' dans l'architecture √©gyptienne ?",
    q_en: "What is a 'dromos' in Egyptian architecture?",
    type: "qcm",
    choices_fr: [
      "All√©e sacr√©e bord√©e de sphinx",
      "Salle de purification",
      "Escalier menant au naos",
      "Couloir d'acc√®s aux chambres fun√©raires"
    ],
    choices_en: [
      "Sacred avenue lined with sphinxes",
      "Purification hall",
      "Staircase leading to the naos",
      "Access corridor to burial chambers"
    ],
    answer: [0]
  },
  {
    q_fr: "Quel pharaon a construit le temple d'Abou Simbel ?",
    q_en: "Which pharaoh built the Abu Simbel temple?",
    type: "qcm",
    choices_fr: ["Rams√®s II", "Tout√¢nkhamon", "Kh√©ops", "Hatchepsout"],
    choices_en: ["Ramses II", "Tutankhamun", "Khufu", "Hatshepsut"],
    answer: [0]
  },

  // ===== QCS (35 questions) =====
  {
    q_fr: "Parmi ces √©l√©ments, lesquels font partie d'un temple √©gyptien typique ?",
    q_en: "Which of these elements are part of a typical Egyptian temple?",
    type: "qcs",
    choices_fr: [
      "Pyl√¥ne",
      "Salle hypostyle",
      "Naos",
      "Th√©√¢tre romain"
    ],
    choices_en: [
      "Pylon",
      "Hypostyle hall",
      "Naos",
      "Roman theater"
    ],
    answer: [0, 1, 2]
  },
  {
    q_fr: "Parmi ces types, lesquels sont des colonnes √©gyptiennes ?",
    q_en: "Which of these are Egyptian column types?",
    type: "qcs",
    choices_fr: [
      "Palmiforme",
      "Hathorique",
      "Ionique",
      "Papyriforme"
    ],
    choices_en: [
      "Palmiform",
      "Hathoric",
      "Ionic",
      "Papyriform"
    ],
    answer: [0, 1, 3]
  },
  {
    q_fr: "Parmi ces √©l√©ments, lesquels caract√©risent les temples du Nouvel Empire ?",
    q_en: "Which elements characterize New Kingdom temples?",
    type: "qcs",
    choices_fr: [
      "Colonnes hathoriques",
      "Ob√©lisques jumeaux",
      "Ziggurats",
      "Salles hypostyles"
    ],
    choices_en: [
      "Hathoric columns",
      "Twin obelisks",
      "Ziggurats",
      "Hypostyle halls"
    ],
    answer: [0, 1, 3]
  },
  {
    q_fr: "Parmi ces techniques, lesquelles √©taient utilis√©es dans la construction √©gyptienne ?",
    q_en: "Which of these techniques were used in Egyptian construction?",
    type: "qcs",
    choices_fr: [
      "Rampes inclin√©es",
      "Grues en bois",
      "Appareillage pr√©cis",
      "B√©ton coul√©"
    ],
    choices_en: [
      "Inclined ramps",
      "Wooden cranes",
      "Precise masonry",
      "Poured concrete"
    ],
    answer: [0, 2]
  },

  // ===== VF (20 questions) =====
  {
    q_fr: "Vrai ou Faux : Le 'serdab' est une pi√®ce ferm√©e abritant des statues du d√©funt sans d√©coration.",
    q_en: "True or False: The 'serdab' is a closed room housing statues of the deceased without decoration.",
    type: "vf",
    answer: true
  },
  {
    q_fr: "Vrai ou Faux : Les pyramides √† faces lisses sont ant√©rieures aux pyramides √† degr√©s.",
    q_en: "True or False: Smooth-faced pyramids predate step pyramids.",
    type: "vf",
    answer: false
  },
  {
    q_fr: "Vrai ou Faux : Le 'pyl√¥ne' est une structure en forme de tour encadrant l'entr√©e des temples √©gyptiens.",
    q_en: "True or False: The 'pylon' is a tower-like structure framing Egyptian temple entrances.",
    type: "vf",
    answer: true
  },
  {
    q_fr: "Vrai ou Faux : Les √âgyptiens utilisaient des grues pour construire les pyramides.",
    q_en: "True or False: Egyptians used cranes to build pyramids.",
    type: "vf",
    answer: false
  }
];

// ===== Remplissage automatique pour atteindre 100 questions =====
(function fillTo100(){
  // G√©n√©rer des questions suppl√©mentaires uniques
  const additionalQuestions = {
    qcm: [
      {
        q_fr: "Quel est l'angle d'inclinaison de la pyramide de Kh√©ops ?",
        q_en: "What is the inclination angle of the Great Pyramid?",
        choices_fr: ["51¬∞50'", "43¬∞22'", "58¬∞10'", "60¬∞"],
        choices_en: ["51¬∞50'", "43¬∞22'", "58¬∞10'", "60¬∞"],
        answer: 0
      },
      {
        q_fr: "Quelle est la fonction des 'chambres de d√©charge' dans la pyramide de Kh√©ops ?",
        q_en: "What is the function of the 'relieving chambers' in Khufu's pyramid?",
        choices_fr: ["R√©duire la pression sur la chambre fun√©raire", "Stocker des offrandes", "Servir de pi√®ge pour les pilleurs"],
        choices_en: ["Reduce pressure on the burial chamber", "Store offerings", "Serve as trap for robbers"],
        answer: 0
      }
    ],
    qcs: [
      {
        q_fr: "Parmi ces mat√©riaux, lesquels √©taient utilis√©s dans l'architecture √©gyptienne ?",
        q_en: "Which of these materials were used in Egyptian architecture?",
        choices_fr: ["Calcaire", "Granit", "Brique crue", "Acier"],
        choices_en: ["Limestone", "Granite", "Mudbrick", "Steel"],
        answer: [0, 1, 2]
      }
    ],
    vf: [
      {
        q_fr: "Vrai ou Faux : La pyramide de Dj√©ser est la premi√®re pyramide √† degr√©s construite en √âgypte.",
        q_en: "True or False: Djoser's pyramid is the first step pyramid built in Egypt.",
        answer: true
      }
    ]
  };

  // Fonction pour ajouter des questions uniques
  const addUniqueQuestions = (type, targetCount, questions) => {
    const currentCount = ALL_QUESTIONS.filter(q => q.type === type).length;
    const needed = targetCount - currentCount;
    
    for (let i = 0; i < needed && i < questions.length; i++) {
      const q = questions[i];
      ALL_QUESTIONS.push({
        q_fr: q.q_fr,
        q_en: q.q_en,
        type: type,
        choices_fr: q.choices_fr || [],
        choices_en: q.choices_en || [],
        answer: Array.isArray(q.answer) ? q.answer : [q.answer]
      });
    }
  };

  // Ajouter des questions suppl√©mentaires
  addUniqueQuestions("qcm", 45, additionalQuestions.qcm);
  addUniqueQuestions("qcs", 35, additionalQuestions.qcs);
  addUniqueQuestions("vf", 20, additionalQuestions.vf);

  // Compl√©ter avec des questions g√©n√©riques si n√©cessaire
  const remainingQCM = 45 - ALL_QUESTIONS.filter(q => q.type === "qcm").length;
  const remainingQCS = 35 - ALL_QUESTIONS.filter(q => q.type === "qcs").length;
  const remainingVF = 20 - ALL_QUESTIONS.filter(q => q.type === "vf").length;

  for (let i = 0; i < remainingQCM; i++) {
    ALL_QUESTIONS.push({
      q_fr: `Question QCM ${i+1}: Quel est l'√©l√©ment principal d'un complexe fun√©raire √©gyptien ?`,
      q_en: `QCM Question ${i+1}: What is the main element of an Egyptian funerary complex?`,
      type: "qcm",
      choices_fr: ["Pyramide", "Temple de la vall√©e", "Chauss√©e", "Tous ces √©l√©ments"],
      choices_en: ["Pyramid", "Valley temple", "Causeway", "All of these"],
      answer: [3]
    });
  }

  for (let i = 0; i < remainingQCS; i++) {
    ALL_QUESTIONS.push({
      q_fr: `Question QCS ${i+1}: Parmi ces caract√©ristiques, lesquelles d√©finissent l'architecture √©gyptienne ?`,
      q_en: `QCS Question ${i+1}: Which of these features define Egyptian architecture?`,
      type: "qcs",
      choices_fr: ["Axialit√©", "Massivit√©", "D√©cor sculpt√©", "Vo√ªtes en crois√©e d'ogives"],
      choices_en: ["Axiality", "Massiveness", "Carved decoration", "Ribbed vaults"],
      answer: [0, 1, 2]
    });
  }

  for (let i = 0; i < remainingVF; i++) {
    ALL_QUESTIONS.push({
      q_fr: `Question VF ${i+1}: Les temples √©gyptiens √©taient souvent peints en couleurs vives.`,
      q_en: `True/False Question ${i+1}: Egyptian temples were often painted in bright colors.`,
      type: "vf",
      answer: true
    });
  }
})();

/* ======== UI & Logic ======== */
const quizContainer = document.getElementById('quiz-container');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const langEl = document.getElementById('lang');
const durationEl = document.getElementById('duration');
const progressEl = document.getElementById('progress');
const timerText = document.getElementById('timerText');
const timerLabel = document.getElementById('timerLabel');
const submitArea = document.getElementById('submit-area');
const summary = document.getElementById('summary');
const submitBtn = document.getElementById('submitBtn');
const scrollTopBtn = document.getElementById('scrollTop');
const sidebar = document.getElementById('sidebar');
const menuToggle = document.getElementById('menuToggle');
const mainContent = document.getElementById('main-content');

let timerInterval = null;
let totalSeconds = 0;
let remaining = 0;
let started = false;

// Precompute circumference for progress circle (r = 48)
const CIRCUMFERENCE = 2 * Math.PI * 48;
progressEl.style.strokeDasharray = `${CIRCUMFERENCE} ${CIRCUMFERENCE}`;
progressEl.style.strokeDashoffset = `${CIRCUMFERENCE}`;

menuToggle.addEventListener('click', ()=>{
  sidebar.classList.toggle('active');
  if (window.innerWidth > 900) mainContent.classList.toggle('shifted');
});

function formatTime(s){
  const m = Math.floor(s/60);
  const sec = s%60;
  return `${m}:${sec<10?'0':''}${sec}`;
}

function renderAllQuestions(){
  quizContainer.innerHTML = '';
  const lang = langEl.value;
  ALL_QUESTIONS.forEach((q, idx) => {
    const card = document.createElement('div');
    card.className = 'question-card';
    const qText = (lang === 'fr') ? q.q_fr : q.q_en;
    const choices = (lang === 'fr') ? q.choices_fr : q.choices_en;
    const header = document.createElement('div');
    header.className = 'q-header';
    header.innerHTML = `<div><div class="q-title">${idx+1}. ${qText}</div>
                        <div class="q-sub">${q.type.toUpperCase()} ‚Äî Question ${idx+1}</div></div>
                        <div style="text-align:right"><button class="quiz-btn" onclick="scrollToQuestion(${idx})">‚§¥</button></div>`;
    card.appendChild(header);

    const choiceBox = document.createElement('div');
    choiceBox.className = 'choices';
    if (q.type === 'qcm'){
      (choices || []).forEach((c, ci) => {
        const id = `q_${idx}_${ci}`;
        const lab = document.createElement('label');
        lab.innerHTML = `<input type="radio" name="q_${idx}" value="${ci}" id="${id}"> ${c}`;
        choiceBox.appendChild(lab);
      });
    } else if (q.type === 'qcs'){
      (choices || []).forEach((c, ci) => {
        const id = `q_${idx}_${ci}`;
        const lab = document.createElement('label');
        lab.innerHTML = `<input type="checkbox" name="q_${idx}" value="${ci}" id="${id}"> ${c}`;
        choiceBox.appendChild(lab);
      });
    } else if (q.type === 'vf'){
      const labT = document.createElement('label');
      labT.innerHTML = `<input type="radio" name="q_${idx}" value="true"> ${lang==='fr'?'Vrai':'True'}`;
      const labF = document.createElement('label');
      labF.innerHTML = `<input type="radio" name="q_${idx}" value="false"> ${lang==='fr'?'Faux':'False'}`;
      choiceBox.appendChild(labT);
      choiceBox.appendChild(labF);
    }
    card.appendChild(choiceBox);

    const note = document.createElement('div');
    note.className = 'small-note';
    note.id = `note_${idx}`;
    card.appendChild(note);

    quizContainer.appendChild(card);
  });

  submitArea.style.display = 'flex';
  summary.textContent = 'Quiz pr√™t. Appuyez sur Submit pour corriger.';
}

function scrollToQuestion(i){
  if (i < 0) i = 0;
  const cards = document.querySelectorAll('.question-card');
  if (i >= cards.length) i = cards.length-1;
  cards[i].scrollIntoView({behavior:'smooth',block:'center'});
}

startBtn.addEventListener('click', ()=>{
  if (started){
    if (!confirm('Le test est en cours. Red√©marrer ?')) return;
    stopTimer();
  }
  renderAllQuestions();
  const mins = parseInt(durationEl.value) || 45;
  totalSeconds = mins * 60;
  remaining = totalSeconds;
  startTimer();
  started = true;
  timerLabel.textContent = 'Temps restant';
  summary.textContent = `Temps: ${mins} min ‚Äî R√©pondez √† toutes les questions puis cliquez Submit.`;
  window.scrollTo({top:0,behavior:'smooth'});
});

resetBtn.addEventListener('click', ()=>{
  if (confirm('R√©initialiser toutes vos r√©ponses ?')){
    const inputs = quizContainer.querySelectorAll('input');
    inputs.forEach(inp => inp.checked = false);
    const notes = document.querySelectorAll('.small-note');
    notes.forEach(n => n.textContent = '');
    summary.textContent = 'R√©ponses r√©initialis√©es.';
  }
});

function startTimer(){
  clearInterval(timerInterval);
  updateProgress();
  timerInterval = setInterval(()=>{
    remaining--;
    if (remaining < 0){
      clearInterval(timerInterval);
      timerText.innerText = '00:00';
      alert('Temps √©coul√© ‚Äî soumission automatique.');
      gradeQuiz();
      return;
    }
    updateProgress();
  },1000);
}

function stopTimer(){
  clearInterval(timerInterval);
  started = false;
  timerLabel.textContent = 'Arr√™t√©';
}

function updateProgress(){
  timerText.innerText = formatTime(remaining);
  const pct = remaining / totalSeconds;
  const offset = CIRCUMFERENCE * (1 - pct);
  progressEl.style.strokeDashoffset = `${offset}`;
  if (pct < 0.15){
    progressEl.style.filter = 'saturate(1.4)';
  } else {
    progressEl.style.filter = 'none';
  }
}

function gradeQuiz(){
  let correctCount = 0;
  const total = ALL_QUESTIONS.length;
  ALL_QUESTIONS.forEach((q, idx) => {
    const noteEl = document.getElementById(`note_${idx}`);
    noteEl.textContent = '';
    if (q.type === 'qcm'){
      const sel = quizContainer.querySelector(`input[name="q_${idx}"]:checked`);
      if (!sel){
        noteEl.textContent = langEl.value==='fr'?'Pas de r√©ponse':'No answer';
        return;
      }
      const val = parseInt(sel.value,10);
      if (Array.isArray(q.answer) && q.answer[0] === val){
        correctCount++;
        noteEl.textContent = langEl.value==='fr'?'‚úî Correct':'‚úî Correct';
      } else {
        const correctText = (langEl.value==='fr' ? (q.choices_fr && q.choices_fr[q.answer[0]]) : (q.choices_en && q.choices_en[q.answer[0]])) || '‚Äî';
        noteEl.textContent = (langEl.value==='fr'?'‚úñ Incorrect ‚Äî R√©ponse: ':'‚úñ Incorrect ‚Äî Answer: ') + correctText;
      }
    } else if (q.type === 'qcs'){
      const boxes = quizContainer.querySelectorAll(`input[name="q_${idx}"]:checked`);
      const picked = Array.from(boxes).map(b=>parseInt(b.value,10)).sort((a,b)=>a-b);
      const correctSorted = (Array.isArray(q.answer) ? q.answer.slice().sort((a,b)=>a-b) : []);
      const ok = picked.length === correctSorted.length && picked.every((v,i)=>v===correctSorted[i]);
      if (ok){
        correctCount++;
        noteEl.textContent = langEl.value==='fr'?'‚úî Correct (toutes les bonnes)':'‚úî Correct (all correct)';
      } else {
        const corr = (langEl.value==='fr') ? (q.answer.map(i=>q.choices_fr && q.choices_fr[i]).join(', ')) : (q.answer.map(i=>q.choices_en && q.choices_en[i]).join(', '));
        noteEl.textContent = (langEl.value==='fr'?'‚úñ Incorrect ‚Äî Bonnes r√©ponses: ':'‚úñ Incorrect ‚Äî Correct answers: ') + (corr || '‚Äî');
      }
    } else if (q.type === 'vf'){
      const sel = quizContainer.querySelector(`input[name="q_${idx}"]:checked`);
      if (!sel){
        noteEl.textContent = langEl.value==='fr'?'Pas de r√©ponse':'No answer';
        return;
      }
      const val = sel.value === 'true';
      if (val === q.answer){
        correctCount++;
        noteEl.textContent = langEl.value==='fr'?'‚úî Correct':'‚úî Correct';
      } else {
        noteEl.textContent = langEl.value==='fr'?'‚úñ Incorrect':'‚úñ Incorrect';
      }
    }
  });

  const percent = Math.round((correctCount/total)*100);
  summary.textContent = (langEl.value==='fr')
    ? `R√©sultat: ${correctCount}/${total} ‚Äî ${percent}%`
    : `Result: ${correctCount}/${total} ‚Äî ${percent}%`;
  stopTimer();
  summary.scrollIntoView({behavior:'smooth',block:'center'});
}

submitBtn.addEventListener('click', ()=>{
  if (!started){
    if (!confirm('Le test n\'a pas commenc√©. Voulez-vous quand m√™me corriger les r√©ponses visibles ?')) return;
  }
  if (!confirm('√ätes-vous s√ªr de vouloir soumettre ‚Äî vous ne pourrez plus modifier vos r√©ponses ?')) return;
  gradeQuiz();
});

scrollTopBtn.addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));

document.addEventListener('keydown',(e)=>{
  if (e.key === 'm') menuToggle.click();
  if (e.key === 's') startBtn.click();
  if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) submitBtn.click();
});

timerText.innerText = '00:00';
progressEl.style.strokeDasharray = `${CIRCUMFERENCE} ${CIRCUMFERENCE}`;
progressEl.style.strokeDashoffset = `${CIRCUMFERENCE}`;
</script>
</body>
</html>
