<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Histoire de l‚ÄôArchitecture 1 ‚Äî Quiz complet</title>

  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    /* --- Design principal (conserve ton style) --- */
    body {
      margin: 0;
      font-family: 'Rubik', sans-serif;
      background: #fff;
      color: #111;
      display: flex;
      min-height: 100vh;
    }

    aside {
      width: 240px;
      background-color: #f4f4f4;
      height: 100vh;
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      overflow-y: auto;
      position: fixed;
      left: 0;
      top: 0;
      transition: transform 0.3s ease;
      z-index: 998;
    }
    aside.hidden { transform: translateX(-260px); }

    .back-button {
      margin-bottom: 20px;
      background-color: #ddd;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    .back-button:hover { background-color: #ccc; }

    aside h2 { font-size: 18px; margin-bottom: 20px; }
    aside a { display: block; padding: 10px; margin-bottom: 10px; text-decoration: none; color: #333; border-radius: 6px; }
    aside a:hover { background-color: #ddd; }

    #toggleSidebar {
      position: fixed; top: 20px; left: 20px; z-index: 999;
      background-color: #111; color: #fff; border: none; padding: 10px 15px;
      font-size: 18px; border-radius: 6px; cursor: pointer;
    }

    main {
      flex-grow: 1;
      padding: 30px;
      margin-left: 240px;
      transition: margin-left 0.3s ease;
    }
    aside.hidden ~ main { margin-left: 0; }

    .section-title { font-size: 26px; margin-bottom: 20px; color:#000; }

    .lesson {
      margin-bottom: 30px;
      background: linear-gradient(180deg, #fbfbfb 0%, #ffffff 100%);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(8,24,40,0.06);
      border: 1px solid rgba(15,23,42,0.04);
    }

    .lesson h3 {
      font-size: 20px;
      margin-bottom: 10px;
      color: #222;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .buttons { margin-top:10px; display:flex; gap:10px; align-items:center; }
    .buttons a, .buttons button {
      background: none;
      border: 1px solid #e6e6e6;
      padding:8px 12px;
      border-radius:8px;
      font-size: 16px;
      cursor: pointer;
      background-color:#fff;
    }
    .buttons a:hover, .buttons button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(8,24,40,0.06);
    }

    footer { margin-top:50px; font-size:13px; color:#888; text-align:center; }

    /* --- Modal Quiz (popup) --- */
    .quiz-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      background: rgba(2,6,23,0.55);
      padding: 24px;
      transition: opacity .18s ease;
    }

    .quiz-card {
      width: 100%;
      max-width: 960px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 20px 50px rgba(2,6,23,0.4);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      animation: pop .18s ease;
      position: relative;
    }

    @keyframes pop {
      from { transform: translateY(12px) scale(.98); opacity: 0; }
      to { transform: translateY(0) scale(1); opacity: 1; }
    }

    .quiz-header {
      padding: 16px 20px;
      background: linear-gradient(90deg,#0ea5a4,#06b6d4);
      color: #fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
    }
    .quiz-header h2 { margin:0; font-size:18px; }
    .quiz-controls { display:flex; gap:12px; align-items:center; }

    .quiz-body {
      padding: 18px;
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 18px;
    }

    .question-area { background:#fbfdff; padding:18px; border-radius:10px; min-height:280px; }
    .question-index { font-size:13px; color:#666; margin-bottom:8px; }
    .question-text { font-size:18px; color:#0f172a; margin-bottom:14px; }

    .options { display:flex; flex-direction:column; gap:10px; }
    .option { background:#fff; border:1px solid #e6eef2; padding:12px 14px; border-radius:8px; cursor:pointer; display:flex; align-items:center; gap:12px; }
    .option input { transform:scale(1.15); }
    .option.disabled { opacity:0.6; pointer-events:none; }

    .sidebar-panel { background:#fff; border-radius:10px; padding:14px; border:1px solid #eef6f9; height:100%; }
    .timer { font-weight:700; font-size:20px; color:#0f172a; }
    .meta { margin-top:12px; color:#475569; font-size:14px; }

    .nav-buttons { display:flex; gap:10px; margin-top:18px; }
    .btn { padding:10px 14px; border-radius:8px; background:#0ea5a4; color:#fff; border:none; cursor:pointer; font-weight:600; }
    .btn.secondary { background:#e6eef2; color:#0f172a; }

    .close-quiz { background:transparent; border:0; color:rgba(255,255,255,0.95); font-weight:700; cursor:pointer; font-size:18px; }

    .result { padding:20px; }
    .result h3 { margin-top:0; }
    .answers-list { margin-top:12px; display:flex; flex-direction:column; gap:10px; max-height:320px; overflow:auto; }
    .answer-item { background:#fcfcff; border:1px solid #eef2ff; padding:12px; border-radius:8px; }

    @media (max-width: 880px) {
      .quiz-body { grid-template-columns: 1fr; }
      .sidebar-panel { order: -1; }
      .quiz-card { max-width: 96%; }
    }
  </style>
</head>
<body>

<button id="toggleSidebar">‚ò∞ Menu</button>

<aside class="sidebar">
  <a href="sem1.html" class="back-button">üîô Retour √† Semestre 1</a>
  <button class="back-button" onclick="history.back()">üîô Retour</button>

  <div class="sidebar-header">
    <h2>üìö Ann√©e 1 - Semestre 1</h2>
  </div>

  <ul class="sidebar-menu">
    <li><a href="atelier1.html">üèóÔ∏è Atelier de projet 1</a></li>
    <li><a href="dca1.html">üìê DCA 1</a></li>
    <li><a href="dag1.html">üé® DAG 1</a></li>
    <li><a href="histoire1.html">üèõÔ∏è Histoire de l‚ÄôArchitecture 1</a></li>
    <li><a href="theorie1.html">üìò Th√©orie de projet 1</a></li>
    <li><a href="geometrie1.html">üìè G√©om√©trie de l‚Äôespace 1</a></li>
    <li><a href="tmc1.html">üß± TMC 1</a></li>
    <li><a href="math1.html">üßÆ Math√©matiques</a></li>
    <li><a href="expression1.html">üó£Ô∏è Expression orale</a></li>
    <li><a href="stage.html">üèûÔ∏è Stage d√©couverte 1</a></li>
    <hr>
    <li><a href="projets.html">üíº Projets</a></li>
    <li><a href="mailto:archispaceiya@gmail.com">üì© Contact</a></li>
  </ul>
</aside>

<main>
  <h1 class="section-title">üèõÔ∏è Histoire de l‚ÄôArchitecture 1</h1>

  <div class="lesson">
    <h3>
      <span>La pr√©histoire et les premiers refuges</span>
      <span>
        <button id="openQuizBtn" title="Ouvrir/fermer le quiz" style="background:#06b6d4;color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600;">üìù Quiz</button>
      </span>
    </h3>
    <div class="buttons">
      <a href="cours_1_prehistoire.pdf"><button>üìÑ PDF</button></a>
      <button>üé• Vid√©o</button>
      <button id="premiumButton1">‚≠ê Premium</button>
      <p id="loadingMessage1" style="display:none; color:#d9534f; margin-top:10px;"></p>
    </div>
  </div>

  <!-- autres le√ßons inchang√©es -->
  <div class="lesson">
    <h3>Architecture m√©sopotamienne</h3>
    <div class="buttons">
      <a href="LA CIVILISATION MESOPOTAMIENNEzd.pdf"><button>üìÑ PDF</button></a>
      <button>üé• Vid√©o</button>
      <button>‚≠ê Premium</button>
    </div>
  </div>

  <div class="lesson">
    <h3>Architecture √©gyptienne</h3>
    <div class="buttons">
      <a href="Egyptian civilization ENG.pdf"><button>üìÑ PDF</button></a>
      <button>üé• Vid√©o</button>
      <button>‚≠ê Premium</button>
    </div>
  </div>

  <footer>
    ¬© 2025 ArchiSpace ‚Äì Tous droits r√©serv√©s.
  </footer>
</main>

<!-- === Modal Quiz complet avec 90 questions incluses === -->
<div id="quizModal" class="quiz-modal" aria-hidden="true">
  <div class="quiz-card" role="dialog" aria-modal="true" aria-labelledby="quizTitle">
    <div class="quiz-header">
      <h2 id="quizTitle">Quiz ‚Äî La pr√©histoire et les premiers refuges</h2>
      <div class="quiz-controls">
        <div style="font-size:13px;opacity:0.95;">Type :</div>
        <select id="quizTypeSelect" style="padding:6px 10px; border-radius:8px; border:none; font-weight:600;">
          <option value="QCM">QCM (choix multiples)</option>
          <option value="QCS">QCS (choix unique)</option>
          <option value="VF">Vrai / Faux</option>
        </select>
        <button class="close-quiz" id="closeQuizBtn" title="Fermer">‚úï</button>
      </div>
    </div>

    <div class="quiz-body">
      <div class="question-area">
        <div class="question-index" id="questionIndex">Question ‚Äî</div>
        <div class="question-text" id="questionText">Choisissez un type puis cliquez sur "Commencer".</div>

        <div class="options" id="optionsContainer"></div>

        <div class="nav-buttons" style="margin-top:14px;">
          <button class="btn secondary" id="prevBtn" disabled>‚óÄ Pr√©c√©dent</button>
          <button class="btn secondary" id="nextBtn" disabled>Suivant ‚ñ∂</button>
          <button class="btn" id="submitBtn" style="display:none;">Soumettre</button>
        </div>
      </div>

      <div class="sidebar-panel">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div style="font-size:13px;color:#64748b;">Timer</div>
            <div class="timer" id="timerDisplay">00:00</div>
          </div>
          <div style="text-align:right;">
            <div style="font-size:13px;color:#64748b;">Score</div>
            <div style="font-weight:700; font-size:18px;" id="scoreDisplay">0</div>
          </div>
        </div>

        <div class="meta">
          <div>Type: <b id="selectedType">‚Äî</b></div>
          <div style="margin-top:8px;">Questions totales: <b id="totalQuestions">30</b></div>
          <div style="margin-top:6px;">Questions restantes: <b id="remainingQuestions">30</b></div>
          <div style="margin-top:8px;">R√©essayer les mauvaises r√©ponses: <input type="checkbox" id="retryWrong" checked></div>
        </div>

        <div style="margin-top:14px;">
          <button class="btn" id="startBtn">Commencer</button>
          <button class="btn secondary" id="endEarlyBtn" style="margin-left:8px;">Finir maintenant</button>
        </div>

        <div style="margin-top:12px; font-size:13px; color:#475569;">
          <div>Navigation: utilisez ‚óÄ / ‚ñ∂ ou les boutons.</div>
          <div style="margin-top:8px;">Apr√®s soumission, les erreurs seront regroup√©es et propos√©es √† nouveau.</div>
        </div>
      </div>
    </div>

    <div id="resultArea" style="display:none;" class="result">
      <h3>R√©sultat</h3>
      <div id="resultSummary"></div>
      <div class="answers-list" id="answersList"></div>
      <div style="margin-top:14px;">
        <button class="btn" id="retryBtn">Reprendre les questions incorrectes</button>
        <button class="btn secondary" id="closeResultBtn" style="margin-left:10px;">Fermer</button>
      </div>
    </div>
  </div>
</div>

<script>
/* Sidebar toggle */
const sidebar = document.querySelector('aside');
const toggleBtn = document.getElementById('toggleSidebar');
toggleBtn.addEventListener('click', () => sidebar.classList.toggle('hidden'));

/* Quiz modal toggle: open/close with same button + close on outside click */
const openQuizBtn = document.getElementById('openQuizBtn');
const quizModal = document.getElementById('quizModal');
const closeQuizBtn = document.getElementById('closeQuizBtn');
const quizTypeSelect = document.getElementById('quizTypeSelect');

openQuizBtn.addEventListener('click', () => {
  if (quizModal.style.display === 'flex') {
    closeQuiz();
  } else {
    openQuiz();
  }
});

closeQuizBtn.addEventListener('click', closeQuiz);

// Close when clicking outside card
quizModal.addEventListener('click', (e) => {
  if (e.target === quizModal) closeQuiz();
});

function openQuiz(){
  quizModal.style.display = 'flex';
  quizModal.setAttribute('aria-hidden','false');
  resetQuizState();
  selectedTypeLabel.textContent = quizTypeSelect.value;
}

function closeQuiz(){
  quizModal.style.display = 'none';
  quizModal.setAttribute('aria-hidden','true');
  stopTimer();
  resultArea.style.display = 'none';
}

/* Quiz logic variables and DOM refs */
const startBtn = document.getElementById('startBtn');
const endEarlyBtn = document.getElementById('endEarlyBtn');
const submitBtn = document.getElementById('submitBtn');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const questionText = document.getElementById('questionText');
const optionsContainer = document.getElementById('optionsContainer');
const questionIndex = document.getElementById('questionIndex');
const timerDisplay = document.getElementById('timerDisplay');
const scoreDisplay = document.getElementById('scoreDisplay');
const selectedTypeLabel = document.getElementById('selectedType');
const totalQuestionsLabel = document.getElementById('totalQuestions');
const remainingQuestionsLabel = document.getElementById('remainingQuestions');
const retryWrongInput = document.getElementById('retryWrong');
const resultArea = document.getElementById('resultArea');
const resultSummary = document.getElementById('resultSummary');
const answersList = document.getElementById('answersList');
const retryBtn = document.getElementById('retryBtn');
const closeResultBtn = document.getElementById('closeResultBtn');

let allQuestions = []; // below: 90 questions
let currentSet = [];
let currentIndex = 0;
let answers = [];
let score = 0;
let timer = null;
let timeLeft = 20 * 60; // default 20 minutes for full quiz
let wrongQuestions = [];
let retryMode = false;

/* =========== QUESTIONS (90) =============
   Chaque objet: { id, type: 'QCM'|'QCS'|'VF', question: '', options: [], answer: [indices] }
   VF use options ["Vrai","Faux"] with answer [0] or [1].
   Les questions sont ordonn√©es du moyen -> tr√®s difficile.
*/
allQuestions = [
/* QCM 1..30 */
{ id: 'qcm1', type:'QCM', question:"Quelles sont les caract√©ristiques principales du Pal√©olithique ?", options:["Agriculture et √©levage","Taille de pierre","Chasse et cueillette","Ma√Ætrise du feu"], answer:[1,2,3]},
{ id: 'qcm2', type:'QCM', question:"Quelles innovations techniques sont associ√©es au Pal√©olithique ?", options:["Fabrication de v√™tements en peaux","Utilisation de la brique crue","Domestication du chien","Culture des c√©r√©ales"], answer:[0,2]},
{ id: 'qcm3', type:'QCM', question:"Parmi ces √©l√©ments, lesquels t√©moignent du N√©olithique ?", options:["Pierre polie","Poterie et tissage","Agriculture","Nomadisme"], answer:[0,1,2]},
{ id: 'qcm4', type:'QCM', question:"Les Natoufiens sont connus pour :", options:["Villages permanents","Am√©nagement des abris naturels","Usage d‚Äôarches monumentales","Utilisation de poteaux de bois"], answer:[0,1,3]},
{ id: 'qcm5', type:'QCM', question:"Quels facteurs ont favoris√© la s√©dentarisation ?", options:["Climat plus chaud","Proximit√© des cours d‚Äôeau","Disponibilit√© de pierres taill√©es","Fertilit√© du sol"], answer:[0,1,3]},
{ id: 'qcm6', type:'QCM', question:"Caract√©ristiques de √áatal H√∂y√ºk :", options:["Maisons agglutin√©es","Acc√®s par les toits","Vo√ªtes en pierre","Utilisation de brique crue"], answer:[0,1,3]},
{ id: 'qcm7', type:'QCM', question:"Avantages d‚Äôun habitat proche d‚Äôun cours d‚Äôeau :", options:["Fertilit√© des terres","Transport facile","Protection contre inondations","Acc√®s √† l‚Äôeau potable"], answer:[0,1,3]},
{ id: 'qcm8', type:'QCM', question:"L‚Äôarchitecture natoufienne comportait :", options:["Cabanes semi-enterr√©es","Sols dall√©s","Colonnes en pierre","Enduits muraux peints"], answer:[0,1,3]},
{ id: 'qcm9', type:'QCM', question:"Les maisons n√©olithiques utilisaient souvent :", options:["Toit plat","Mat√©riaux locaux","Absence d‚Äô√©tages","Grandes fen√™tres"], answer:[0,1,2]},
{ id: 'qcm10', type:'QCM', question:"Pourquoi utiliser la brique crue ?", options:["Disponibilit√© des mat√©riaux","Facilit√© de mise en ≈ìuvre","R√©sistance √† l‚Äôeau","Isolation thermique"], answer:[0,1,3]},
{ id: 'qcm11', type:'QCM', question:"Impact du climat sur l‚Äôhabitat :", options:["Choix des mat√©riaux","Organisation des villages","Apparition des arcs","Proximit√© des ressources"], answer:[0,1,3]},
{ id: 'qcm12', type:'QCM', question:"Organisation spatiale de √áatal H√∂y√ºk :", options:["Densit√© √©lev√©e","Absence de rues traditionnelles","Grande place centrale","Acc√®s par les toits"], answer:[0,1,3]},
{ id: 'qcm13', type:'QCM', question:"Mat√©riaux utilis√©s dans les villages natoufiens :", options:["Pierre brute","Bois","Terre crue","Acier"], answer:[0,1,2]},
{ id: 'qcm14', type:'QCM', question:"Transition Pal√©olithique ‚Üí N√©olithique inclut :", options:["Agriculture","√âlevage","Domestication du cheval","Poterie"], answer:[0,1,3]},
{ id: 'qcm15', type:'QCM', question:"Am√©nagement int√©rieur natoufien : ", options:["Enduits muraux","Poteaux de soutien","Escaliers int√©rieurs","Sols dall√©s"], answer:[0,1,3]},
{ id: 'qcm16', type:'QCM', question:"Structures de d√©fense naturelles utilis√©es :", options:["Utilisation des pentes","Implantation strat√©gique","Tours de garde en pierre","Hauteur du terrain"], answer:[0,1,3]},
{ id: 'qcm17', type:'QCM', question:"√âl√©ments culturels li√©s √† l‚Äôhabitat pr√©historique :", options:["D√©coration murale","Organisation collective","Usage du marbre","Espaces rituels"], answer:[0,1,3]},
{ id: 'qcm18', type:'QCM', question:"Diff√©rences majeures Pal√©olithique/N√©olithique :", options:["Nomadisme vs s√©dentarit√©","Chasse vs agriculture","Usage de fer","Taille vs polissage de pierre"], answer:[0,1,3]},
{ id: 'qcm19', type:'QCM', question:"Avantages des toits plats dans les villages n√©olithiques :", options:["Espace de vie ext√©rieur","Acc√®s direct au logement","Isolation contre pluie forte","Stockage"], answer:[0,1,3]},
{ id: 'qcm20', type:'QCM', question:"Raisons d‚Äôun habitat dense √† √áatal H√∂y√ºk :", options:["D√©fense collective","Limitation d‚Äôespace constructible","Confort thermique absolu","Organisation sociale"], answer:[0,1,3]},
{ id: 'qcm21', type:'QCM', question:"Quels indices montrent une premi√®re sp√©cialisation des t√¢ches ?", options:["Pr√©sence d‚Äôateliers","Objets standardis√©s","Grandes habitations aristocratiques","R√©serves alimentaires"], answer:[0,1,3]},
{ id: 'qcm22', type:'QCM', question:"Les sols dall√©s et enduits indiquent :", options:["Soin de l‚Äôhabitat","Symbolisme religieux","Technique de stockage","Absence de mobilier"], answer:[0,2]},
{ id: 'qcm23', type:'QCM', question:"La fonction des poteaux circulaires au centre des maisons natoufiennes √©tait probablement :", options:["Support de la charpente","Monument fun√©raire","Espace rituel","Syst√®me de ventilation"], answer:[0,2]},
{ id: 'qcm24', type:'QCM', question:"La densit√© et l'agglutination des maisons entra√Æne :", options:["Circulation par toits","Acc√®s priv√© limit√©","Pr√©sence de rues larges","Organisation collective des terrasses"], answer:[0,1,3]},
{ id: 'qcm25', type:'QCM', question:"Comment la topographie influence-t-elle le choix du site ?", options:["Protection naturelle","Orientation solaire","Disponibilit√© d‚Äôagr√©gats","Pr√©sence d‚Äôarbres"], answer:[0,1]},
{ id: 'qcm26', type:'QCM', question:"La pr√©sence de foyers fixes indique :", options:["S√©dentarit√© partielle","Contr√¥le du feu","Activit√©s culinaires","Rituel social"], answer:[0,1,2,3]},
{ id: 'qcm27', type:'QCM', question:"Quel(s) √©l√©ment(s) d√©finissent un habitat n√©olithique avanc√© ?", options:["Briques de terre","Stockage organis√©","Cha√Ænes d‚Äô√©change lointaines","Architecture monumentale"], answer:[0,1,2]},
{ id: 'qcm28', type:'QCM', question:"Pourquoi l‚Äôorientation des rues (ombre/vent) est importante ?", options:["Confort thermique","√âvacuation des eaux","Signalisation urbaine","Acc√®s aux march√©s"], answer:[0,1]},
{ id: 'qcm29', type:'QCM', question:"Indices d‚Äôune vie collective √† √áatal H√∂y√ºk :", options:["Rituels domestiques","D√©cors muraux communs","Nao de commerce","Murs partag√©s entre maisons"], answer:[0,1,3]},
{ id: 'qcm30', type:'QCM', question:"Ce qui fait qu‚Äôun site pr√©historique devient un centre majeur :", options:["Ressources abondantes","Emplacement strat√©gique","Complexit√© architecturale","Pr√©sence d‚Äôun pouvoir centralis√©"], answer:[0,1,2]},

/* QCS 31..60 */
{ id:'qcs31', type:'QCS', question:"Quel animal a √©t√© domestiqu√© en premier ?", options:["Ch√®vre","Chien","Cheval","B≈ìuf"], answer:[1]},
{ id:'qcs32', type:'QCS', question:"Le N√©olithique commence au Proche-Orient vers :", options:["12 000 av. J.-C.","9 000 av. J.-C.","5 500 av. J.-C.","3 300 av. J.-C."], answer:[1]},
{ id:'qcs33', type:'QCS', question:"L'utilisation de la brique crue appara√Æt principalement :", options:["Au Pal√©olithique","Au N√©olithique","En M√©sopotamie uniquement","En √âgypte ancienne"], answer:[1]},
{ id:'qcs34', type:'QCS', question:"Quel type d'acc√®s caract√©rise √áatal H√∂y√ºk ?", options:["Portes sur rue","Acc√®s par toits","Entr√©es monumentales","Escaliers ext√©rieurs"], answer:[1]},
{ id:'qcs35', type:'QCS', question:"La pr√©sence de sols dall√©s indique :", options:["Mobilier mobile","S√©dentarit√© et soin de l‚Äôhabitat","Absence de pratiques domestiques","Usage rituel uniquement"], answer:[1]},
{ id:'qcs36', type:'QCS', question:"Les poteries apparaissent massivement au :", options:["Pal√©olithique","Moyen √Çge","N√©olithique","Antiquit√© tardive"], answer:[2]},
{ id:'qcs37', type:'QCS', question:"Une caract√©ristique urbaine naissante est :", options:["Pr√©sence d‚Äôun gouverneur local","Construction en acier","R√©seau routier pav√©","Syst√®mes √©lectriques"], answer:[0]},
{ id:'qcs38', type:'QCS', question:"Le plus grand √©tablissement n√©olithique connu, √áatal H√∂y√ºk, se situe en :", options:["√âgypte","Anatolie","M√©sopotamie","Europe de l‚ÄôOuest"], answer:[1]},
{ id:'qcs39', type:'QCS', question:"Quel √©l√©ment est typiquement absent des maisons n√©olithiques ?", options:["Fen√™tres larges","Toits plats","Mat√©riaux locaux","Absence d‚Äô√©tages"], answer:[0]},
{ id:'qcs40', type:'QCS', question:"L‚Äôinvention de la roue se situe approximativement :", options:["Au Pal√©olithique","Au N√©olithique","√Ä l‚Äô√©poque romaine","Au Moyen √Çge"], answer:[1]},
{ id:'qcs41', type:'QCS', question:"Les maisons semi-enterr√©es permettent surtout :", options:["Meilleure isolation thermique","Construire des √©tages","Cr√©er des fen√™tres plus grandes","Acc√®s direct par la rue"], answer:[0]},
{ id:'qcs42', type:'QCS', question:"Quel mat√©riau est le plus utilis√© dans les premi√®res constructions permanentes ?", options:["Bois et terre crue","B√©ton","Marbre","Acier"], answer:[0]},
{ id:'qcs43', type:'QCS', question:"Les enduits muraux peints t√©moignent de :", options:["Fonctions domestiques seulement","Formes d‚Äôexpression symbolique","Absence de savoir-faire","Imitation romaine"], answer:[1]},
{ id:'qcs44', type:'QCS', question:"La domestication du chien a surtout servi pour :", options:["Transport","Aide √† la chasse","Construction","Rituel"], answer:[1]},
{ id:'qcs45', type:'QCS', question:"La pr√©sence d‚Äôun puit fun√©raire indique :", options:["Pratiques de protection contre pillage","Syst√®mes d‚Äôirrigation","Habitudes de stockage","Techniques m√©tallurgiques"], answer:[0]},
{ id:'qcs46', type:'QCS', question:"L‚Äôorganisation en terrasses pour acc√©der aux maisons est typique de :", options:["√áatal H√∂y√ºk","Rome","√âgypte","Gr√®ce"], answer:[0]},
{ id:'qcs47', type:'QCS', question:"La s√©dentarisation entra√Æne principalement :", options:["R√©duction des √©changes","D√©veloppement de l‚Äôagriculture","Disparition des rituels","Urbanisme moderne"], answer:[1]},
{ id:'qcs48', type:'QCS', question:"Un des premiers indices d‚Äôarchitecture planifi√©e est :", options:["Pr√©sence d‚Äôalignements r√©guliers de maisons","Pr√©sence de tours m√©di√©vales","Usage de marbre","R√©seaux d‚Äô√©gouts"], answer:[0]},
{ id:'qcs49', type:'QCS', question:"Quel crit√®re explique la long√©vit√© du site de √áatal H√∂y√ºk ?", options:["Isolation compl√®te","Fertilit√© et ressources locales","Climat polaire","Pr√©sence d‚Äôun roi"], answer:[1]},
{ id:'qcs50', type:'QCS', question:"Parmi ces techniques, laquelle n‚Äôappartient pas aux d√©buts n√©olithiques ?", options:["Poterie","Tissage","Usage r√©pandu du m√©tal","Domestication d‚Äôanimaux"], answer:[2]},
{ id:'qcs51', type:'QCS', question:"La pr√©sence de r√©serves alimentaires indique :", options:["Activit√© commerciale","Stockage collectif et planification","Structure militaire","Absence d‚Äô√©levage"], answer:[1]},
{ id:'qcs52', type:'QCS', question:"Les poteaux centraux dans une maison servent principalement √† :", options:["Supporter la charpente","Servir d‚Äôautel religieux","Entr√©e principale","Syst√®me d‚Äô√©vacuation"], answer:[0]},
{ id:'qcs53', type:'QCS', question:"Quel avantage apporte la proximit√© d'une rivi√®re ?", options:["Barri√®re d√©fensive naturelle","Transport et irrigation","Isolation culturelle","Production de marbre"], answer:[1]},
{ id:'qcs54', type:'QCS', question:"Un signe d‚Äôoccupation permanente est :", options:["Pr√©sence de mobilier mobile seulement","Construction d‚Äô√©l√©ments fixes comme foyers et silos","Absence de structures durables","Mobilit√© totale"], answer:[1]},
{ id:'qcs55', type:'QCS', question:"L‚Äôagglutination des maisons √† √áatal H√∂y√ºk favorise :", options:["La vie priv√©e accrue","L‚Äôorganisation collective et la d√©fense","La cr√©ation de grandes places ouvertes","La circulation automobile"], answer:[1]},
{ id:'qcs56', type:'QCS', question:"La poterie d√©cor√©e indique souvent :", options:["Fonction purement utilitaire","Signes d‚Äôidentit√©s et √©changes culturels","Absence de hi√©rarchie","Techniques m√©talliques avanc√©es"], answer:[1]},
{ id:'qcs57', type:'QCS', question:"Quelle est la principale raison pour laquelle on enterrait les tombes profond√©ment ?", options:["Protection contre le pillage","Rituel de fertilit√©","Difficult√© technique","Esth√©tique"], answer:[0]},
{ id:'qcs58', type:'QCS', question:"La construction sur des monticules (tells) est li√©e √† :", options:["Accumulation de vestiges","Pr√©dilection pour l‚Äôaltitude","Usage c√©r√©moniel","Raret√© des mat√©riaux"], answer:[0]},
{ id:'qcs59', type:'QCS', question:"Une caract√©ristique des villages dens√©ment peupl√©s est :", options:["Rues larges et orthogonales","Acc√®s par toits et surfaces partag√©es","Pr√©sence d‚Äôaqueducs romains","Usage du marbre"], answer:[1]},
{ id:'qcs60', type:'QCS', question:"Pourquoi l‚Äôagriculture a-t-elle transform√© l‚Äôarchitecture ?", options:["Moins besoin d‚Äôabris","Permet stockage et constructions durables","Remplace l‚Äôartisanat","Diminue la population"], answer:[1]},

/* VF 61..90 */
{ id:'vf61', type:'VF', question:"Les Natoufiens vivaient uniquement dans des grottes.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf62', type:'VF', question:"La roue appara√Æt au N√©olithique.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf63', type:'VF', question:"√áatal H√∂y√ºk √©tait construit en pierre taill√©e uniquement.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf64', type:'VF', question:"La s√©dentarisation est directement li√©e au d√©veloppement de l‚Äôagriculture.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf65', type:'VF', question:"Les maisons n√©olithiques avaient g√©n√©ralement de grandes fen√™tres pour la lumi√®re.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf66', type:'VF', question:"Les enduits muraux peints t√©moignent d‚Äôun souci esth√©tique et symbolique.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf67', type:'VF', question:"La brique crue est un mat√©riau r√©pandu dans les premiers villages permanents.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf68', type:'VF', question:"Les foyers fixes sont un indice d‚Äôhabitat mobile et non permanent.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf69', type:'VF', question:"Les maisons semi-enterr√©es offrent une meilleure isolation thermique.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf70', type:'VF', question:"La densit√© des constructions emp√™che totalement la vie collective.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf71', type:'VF', question:"Les toits plats peuvent servir d‚Äôespace de circulation et d‚Äôactivit√©.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf72', type:'VF', question:"La pr√©sence d‚Äôun puit fun√©raire sert souvent √† prot√©ger la tombe du pillage.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf73', type:'VF', question:"Les villages n√©olithiques n‚Äôavaient aucune organisation spatiale.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf74', type:'VF', question:"Les poteaux centraux dans une maison √©taient uniquement d√©coratifs.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf75', type:'VF', question:"L‚Äôorientation des voies et des habitations pouvait r√©pondre √† des contraintes climatiques (ombre/vent).", options:["Vrai","Faux"], answer:[0]},
{ id:'vf76', type:'VF', question:"La s√©dentarisation n‚Äôa eu aucun effet sur la division du travail.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf77', type:'VF', question:"La poterie est un indice de stockage et de s√©dentarit√©.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf78', type:'VF', question:"La construction en pierre massive est typique de tous les sites n√©olithiques.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf79', type:'VF', question:"On trouve des enduits peints et des sols dall√©s m√™me dans des habitats tr√®s anciens.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf80', type:'VF', question:"Les maisons agglutin√©es favorisent la d√©fense collective.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf81', type:'VF', question:"La disponibilit√© des ressources locales est secondaire dans le choix du site.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf82', type:'VF', question:"Les villages montrent parfois des signes d‚Äôorganisation religieuse partag√©e.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf83', type:'VF', question:"Les techniques de construction √©voluent tr√®s rapidement sans lien avec l‚Äô√©conomie.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf84', type:'VF', question:"L‚Äôaccumulation de vestiges (tells) est due √† des occupations successives.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf85', type:'VF', question:"Les routes et rues larges sont une caract√©ristique permanente des premiers villages.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf86', type:'VF', question:"La sp√©cialisation des t√¢ches peut √™tre d√©duite des ateliers identifi√©s sur les sites.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf87', type:'VF', question:"Les pratiques fun√©raires n‚Äôapportent aucune information sur l‚Äôorganisation sociale.", options:["Vrai","Faux"], answer:[1]},
{ id:'vf88', type:'VF', question:"L‚Äô√©tude des mat√©riaux (terre, bois) renseigne sur les choix techniques locaux.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf89', type:'VF', question:"La pr√©sence d‚Äôobjets standardis√©s indique souvent des √©changes et sp√©cialisation.", options:["Vrai","Faux"], answer:[0]},
{ id:'vf90', type:'VF', question:"Les sites majeurs se d√©veloppent uniquement pour des raisons religieuses.", options:["Vrai","Faux"], answer:[1]}
];

/* =========== Helpers =========== */
function getQuestionsByType(type) {
  if (type === 'QCM') return allQuestions.filter(q => q.type === 'QCM');
  if (type === 'QCS') return allQuestions.filter(q => q.type === 'QCS');
  return allQuestions.filter(q => q.type === 'VF');
}

/* Reset/Start/Timer/Render logic */
function resetQuizState(){
  stopTimer();
  resultArea.style.display = 'none';
  selectedTypeLabel.textContent = quizTypeSelect.value;
  totalQuestionsLabel.textContent = 30;
  remainingQuestionsLabel.textContent = 30;
  questionText.textContent = "Choisissez un type puis cliquez sur Commencer.";
  optionsContainer.innerHTML = '';
  questionIndex.textContent = "Question ‚Äî";
  scoreDisplay.textContent = '0';
  startBtn.disabled = false;
  submitBtn.style.display = 'none';
  prevBtn.disabled = true;
  nextBtn.disabled = true;
  // clear internal state
  currentSet = [];
  currentIndex = 0;
  answers = [];
  score = 0;
  wrongQuestions = [];
  retryMode = false;
}

startBtn.addEventListener('click', () => {
  startQuiz(quizTypeSelect.value);
});
endEarlyBtn.addEventListener('click', () => {
  finishQuiz();
});
prevBtn.addEventListener('click', () => {
  saveCurrentAnswer();
  if (currentIndex > 0) currentIndex--;
  renderQuestion();
});
nextBtn.addEventListener('click', () => {
  saveCurrentAnswer();
  if (currentIndex < currentSet.length - 1) currentIndex++;
  renderQuestion();
});
submitBtn.addEventListener('click', () => {
  saveCurrentAnswer();
  finishQuiz();
});
retryBtn.addEventListener('click', () => {
  if (wrongQuestions.length === 0) return;
  retryMode = true;
  currentSet = wrongQuestions.map(id => allQuestions.find(q => q.id === id));
  totalQuestionsLabel.textContent = currentSet.length;
  remainingQuestionsLabel.textContent = currentSet.length;
  answers = Array(currentSet.length).fill(null);
  wrongQuestions = [];
  currentIndex = 0;
  score = 0;
  scoreDisplay.textContent = score;
  resultArea.style.display = 'none';
  selectedTypeLabel.textContent = quizTypeSelect.value + ' (reprise)';
  timeLeft = Math.max(3 * 60, Math.floor(timeLeft/2)); // give some time for reprise
  startTimer();
  renderQuestion();
});
closeResultBtn.addEventListener('click', closeQuiz);

/* Start quiz */
function startQuiz(type) {
  retryMode = false;
  selectedTypeLabel.textContent = type;
  currentSet = getQuestionsByType(type);
  // keep order: moyen -> difficile
  answers = Array(currentSet.length).fill(null);
  currentIndex = 0;
  score = 0;
  wrongQuestions = [];
  totalQuestionsLabel.textContent = currentSet.length;
  remainingQuestionsLabel.textContent = currentSet.length;
  startBtn.disabled = true;
  submitBtn.style.display = 'inline-block';
  prevBtn.disabled = false;
  nextBtn.disabled = false;
  scoreDisplay.textContent = score;
  timeLeft = 20 * 60; // 20 min full
  startTimer();
  renderQuestion();
}

/* Timer */
function startTimer() {
  stopTimer();
  updateTimerDisplay();
  timer = setInterval(() => {
    timeLeft--;
    updateTimerDisplay();
    if (timeLeft <= 0) {
      stopTimer();
      finishQuiz();
    }
  }, 1000);
}
function stopTimer() {
  if (timer) { clearInterval(timer); timer = null; }
}
function updateTimerDisplay() {
  const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
  const s = (timeLeft%60).toString().padStart(2,'0');
  timerDisplay.textContent = `${m}:${s}`;
}

/* Render question */
function renderQuestion(){
  const q = currentSet[currentIndex];
  questionIndex.textContent = `Question ${currentIndex+1} / ${currentSet.length}`;
  questionText.textContent = q.question;
  optionsContainer.innerHTML = '';
  remainingQuestionsLabel.textContent = currentSet.length - currentIndex;
  selectedTypeLabel.textContent = quizTypeSelect.value + (retryMode ? ' (reprise)' : '');

  if (q.type === 'QCM') {
    q.options.forEach((opt, i) => {
      const div = document.createElement('label');
      div.className = 'option';
      const input = document.createElement('input');
      input.type = 'checkbox';
      input.name = 'opt';
      input.value = i;
      const prev = answers[currentIndex];
      if (Array.isArray(prev) && prev.includes(i)) input.checked = true;
      div.appendChild(input);
      const span = document.createElement('span');
      span.textContent = opt;
      div.appendChild(span);
      optionsContainer.appendChild(div);
    });
  } else if (q.type === 'QCS') {
    q.options.forEach((opt, i) => {
      const div = document.createElement('label');
      div.className = 'option';
      const input = document.createElement('input');
      input.type = 'radio';
      input.name = 'opt';
      input.value = i;
      if (Array.isArray(answers[currentIndex]) && answers[currentIndex][0] === i) input.checked = true;
      div.appendChild(input);
      const span = document.createElement('span');
      span.textContent = opt;
      div.appendChild(span);
      optionsContainer.appendChild(div);
    });
  } else { // VF
    ['Vrai','Faux'].forEach((opt, i) => {
      const div = document.createElement('label');
      div.className = 'option';
      const input = document.createElement('input');
      input.type = 'radio';
      input.name = 'opt';
      input.value = i;
      if (Array.isArray(answers[currentIndex]) && answers[currentIndex][0] === i) input.checked = true;
      div.appendChild(input);
      const span = document.createElement('span');
      span.textContent = opt;
      div.appendChild(span);
      optionsContainer.appendChild(div);
    });
  }

  prevBtn.disabled = currentIndex === 0;
  nextBtn.disabled = currentIndex === currentSet.length - 1;
}

/* Save current answer */
function saveCurrentAnswer(){
  const q = currentSet[currentIndex];
  const inputs = Array.from(optionsContainer.querySelectorAll('input[name="opt"]'));
  if (q.type === 'QCM') {
    const chosen = inputs.filter(i => i.checked).map(i => parseInt(i.value));
    answers[currentIndex] = chosen.length ? chosen : null;
  } else {
    const chosen = inputs.find(i => i.checked);
    answers[currentIndex] = chosen ? [parseInt(chosen.value)] : null;
  }
}

/* Finish quiz and compute score */
function finishQuiz(){
  stopTimer();
  saveCurrentAnswer();
  score = 0;
  wrongQuestions = [];
  currentSet.forEach((q, idx) => {
    const userAns = answers[idx];
    const correct = q.answer;
    if (!userAns || userAns.length === 0) {
      wrongQuestions.push(q.id);
      return;
    }
    const sortedUser = userAns.slice().sort((a,b)=>a-b);
    const sortedCorr = correct.slice().sort((a,b)=>a-b);
    const equal = sortedUser.length === sortedCorr.length && sortedUser.every((v,i)=>v===sortedCorr[i]);
    if (equal) score++;
    else wrongQuestions.push(q.id);
  });

  scoreDisplay.textContent = score + " / " + currentSet.length;
  showResults();
}

/* Show results */
function showResults(){
  resultArea.style.display = 'block';
  resultSummary.innerHTML = `<p>Vous avez obtenu <strong>${score}</strong> sur <strong>${currentSet.length}</strong>.</p>
    <p>Correctes : ${score}. Incorrectes : ${currentSet.length - score}.</p>`;
  answersList.innerHTML = '';
  currentSet.forEach((q, idx) => {
    const userAns = answers[idx];
    const corr = q.answer;
    const item = document.createElement('div');
    item.className = 'answer-item';
    const title = document.createElement('div');
    title.style.fontWeight = '700';
    title.textContent = `Q${idx+1} ‚Äî ${q.question}`;
    item.appendChild(title);

    const ua = document.createElement('div');
    ua.style.marginTop = '8px';
    let uaText = 'Votre r√©ponse : ';
    if (!userAns || userAns.length === 0) uaText += '<em>Pas de r√©ponse</em>';
    else uaText += userAns.map(i => q.options[i]).join(', ');
    ua.innerHTML = uaText;
    item.appendChild(ua);

    const ca = document.createElement('div');
    ca.style.marginTop = '6px';
    ca.innerHTML = `<strong>R√©ponse correcte :</strong> ${corr.map(i => q.options[i]).join(', ')}`;
    item.appendChild(ca);

    const mark = document.createElement('div');
    mark.style.marginTop = '8px';
    const isCorrect = userAns && userAns.length && (userAns.slice().sort().toString() === corr.slice().sort().toString());
    mark.innerHTML = isCorrect ? `<span style="color:green;font-weight:700">‚úî Bonne r√©ponse</span>` : `<span style="color:#d6336c;font-weight:700">‚úñ Mauvaise r√©ponse</span>`;
    item.appendChild(mark);

    answersList.appendChild(item);
  });

  if (!retryWrongInput.checked || wrongQuestions.length === 0) retryBtn.disabled = true;
  else retryBtn.disabled = false;
}

/* Optional: shuffle function (commented) */
/* function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; } */

</script>
</body>
</html>
